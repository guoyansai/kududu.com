import{d as t,b as o,r as l,O as a,j as e,o as n,w as s,l as i,k as c,V as r,E as p,q as d,u,N as b,F as g,s as v,z as m,c as x,n as y}from"./chunk-asai-BcUlmSst.js";import{_ as j}from"./entry-asai-C1GKnLJc.js";const f={class:"load-index"},T={key:0,class:"load-index_content load-index_step_one"},k={class:"frame radio-group"},w={key:1,class:"load-index_content"},S={class:"content-title"},h={class:"step"},A={class:"content-text"},L={class:"text-div"},_={class:"content-text"},P={class:"text-div"},q={class:"text-red"},C={key:2,class:"load-index_content"},N={class:"content-title"},E={class:"step"},I={class:"content-text"},R={class:"text-div"},F=["innerHTML"],V={class:"text-div"},$={class:"text-div"},K=["innerHTML"],z={key:3,class:"load-index_content"},M={class:"content-title"},W={class:"step"},H={class:"content-text"},U={class:"text-div"},D={class:"tape-sampling"},J={class:"tape-sampling-btn"},O={class:"tape-sampling-btn"},G={key:0},B={key:1},Q={class:"tape-sampling-text"},X={key:0,class:"tape-error"},Y={key:1,class:"tape-error"},Z={key:4,class:"load-index_content"},tt={class:"content-title"},ot={class:"step"},lt={class:"form"},at={class:"form-val"},et={class:"form-val"},nt={class:"form-val"},st={key:0,class:"acceptable"},it={class:"form-val"},ct={class:"form-val"},rt={key:5,class:"load-index_content"},pt={class:"content-title"},dt={class:"step"},ut={class:"content-text"},bt={class:"text-div"},gt={class:"text-div"},vt={class:"text-div"},mt={class:"text-red"},xt={class:"content-operate"},yt=["src"],jt={class:"operate"},ft={key:0},Tt={key:1},kt={key:6,class:"load-index_btn"},wt=j(t({__name:"RobotPayload",props:{ujt:{}},setup(t){const j=t,{$global:wt,$fn:St,$ws:ht}=j.ujt,{switchPower:At}=St.useProjectWs(j.ujt),{moveTo:Lt}=St.usePointSet(j.ujt),_t=o({step:0,lastStep:8,calibrateType:2,sampling:[null,null,null,null],sampleText:!1,btnLoading:!1,results:null,id:1,numberList:[{label:"Tool1",value:1},{label:"Tool2",value:2},{label:"Tool3",value:3},{label:"Tool4",value:4},{label:"Tool5",value:5},{label:"Tool6",value:6},{label:"Tool7",value:7},{label:"Tool8",value:8},{label:"Tool9",value:9},{label:"Tool10",value:10},{label:"Tool11",value:11},{label:"Tool12",value:12},{label:"Tool13",value:13},{label:"Tool14",value:14},{label:"Tool15",value:15}],posKey:["one","tow","three","four"],btnLoadingArr:[!1,!1,!1,!1],samplePTextArr:[!1,!1,!1,!1],sampleTextArr:[!1,!1,!1,!1],time:5,loadNextStep:!1,existTorque:!1,loadoption:[{label:St.lg("cocontrol.calibration.torquesensor"),value:1,disabled:!0},{label:St.lg("cocontrol.calibration.jointsensor"),value:2}]});let Pt=null;function qt(t){_t.sampling=[null,null,null,null],_t.id=1,_t.results=null,_t.sampleText=!1,_t.samplePTextArr=[!1,!1,!1,!1],_t.sampleTextArr=[!1,!1,!1,!1],1===t?_t.lastStep=6:2===t&&(_t.lastStep=8)}function Ct(){1===_t.step&&(Pt&&clearInterval(Pt),_t.loadNextStep=!1,_t.time=5),7===_t.step&&(_t.btnLoadingArr=[!1,!1,!1,!1]),_t.sampleText=!1,_t.step-=1}function Nt(){2===_t.calibrateType&&6===_t.step?St.ws.cocontrol.wsApi({ty:"trajectory/EnableLoadIdentificationMode",db:""}).then((t=>{(null==t?void 0:t.db)&&(At(),Et())})):2===_t.calibrateType&&0===_t.step?(_t.loadNextStep=!0,Pt=setInterval((()=>{_t.time<2?(clearInterval(Pt),_t.loadNextStep=!1,_t.time=5):_t.time-=1}),1e3),Et()):2===_t.calibrateType&&1===_t.step?(At(),Et()):Et()}function Et(){let t="Robot/PayloadIdentificationFTS",o=5;2===_t.calibrateType&&(t="Robot/PayloadIdentificationJS",o=7),_t.step===o?St.ws.cocontrol.wsApi({ty:t,db:_t.sampling}).then((t=>{var o,l;(null==(o=null==t?void 0:t.db)?void 0:o.errmsg)?wt.msg.fn({type:"err",con:St.lg("cocontrol.calibration.identificationfailure")}):2!==_t.calibrateType||(null==(l=null==t?void 0:t.db)?void 0:l.succeed)?(_t.results=t.db,It()):wt.msg.fn({type:"err",con:St.lg("cocontrol.calibration.succeedtip")})})):(_t.sampleText=!1,It())}function It(){_t.step+=1}function Rt(){if(!_t.sampling[_t.step-2]&&_t.step>1&&_t.step<5)return!0;let t=!1;if(7===_t.step)for(let o of _t.sampling)if(!o.jntTrqWithLoad){t=!0;break}return t}function Ft(){_t.results.isResultsAcceptable?Vt():wt.popbox.poptips={fn:Vt,tips:St.lg("cocontrol.calibration.resulttext"),icon:"./assets/img/robot/danger.png"}}function Vt(){let t={id:_t.id,params:_t.results};St.ws.cocontrol.wsApi({ty:"Robot/ChangeToolDynParams",db:t}).then((t=>{wt.msg.fn({type:"ok",con:St.lg("cocontrol.calibration.successmessage")})}))}function $t(){_t.sampling[_t.step-2]=null,_t.sampleText=!1,_t.btnLoading=!0;let t="FTSensor/SampleFTS";2===_t.calibrateType&&(t="Robot/LoadIdenJSSample"),St.ws.cocontrol.wsApi({ty:t,db:""}).then((t=>{var o;(null==(o=null==t?void 0:t.db)?void 0:o.errmsg)||(t.db.isSampleAcceptable?_t.sampling[_t.step-2]={jntPos:Kt(),jntTrqWithoutLoad:t.db.data}:_t.sampleText=!0),_t.btnLoading=!1}))}function Kt(){var t,o;return(null==(o=null==(t=null==ht?void 0:ht.cocontrol)?void 0:t.robotposture)?void 0:o.joint)||[]}function zt(t,o=0){var l;if(t){let a=null==(l=null==t?void 0:t.toString())?void 0:l.split(".");return a.length>1&&a[1].length>=o?o?`${a[0]}.${a[1].substring(0,o)}`:a[0]:t}return 0}return St.ws.cocontrol.wsApi({ty:"Robot/ExistTorqueSensor",db:""}).then((t=>{_t.existTorque=t.db})),(t,o)=>{var j,ht,Pt,Et,It,Vt,Mt,Wt,Ht,Ut,Dt,Jt,Ot,Gt,Bt,Qt;const Xt=l("el-radio-group"),Yt=l("el-button"),Zt=l("el-select"),to=a("pointerdown");return n(),e("div",f,[0===_t.step?(n(),e("div",T,[i("div",k,[c(Xt,{modelValue:_t.calibrateType,"onUpdate:modelValue":o[0]||(o[0]=t=>_t.calibrateType=t),options:_t.loadoption,vertical:"",onChange:qt,disabled:!_t.existTorque},null,8,["modelValue","options","disabled"])])])):1===_t.step?(n(),e("div",w,[i("div",S,[i("span",h,d(u(St).lg("cocontrol.calibration.step"))+"  "+d(_t.step)+" / "+d(_t.lastStep),1),p(" "+d(u(St).lg("cocontrol.calibration.overview")),1)]),i("div",A,[i("div",L,d(u(St).lg("cocontrol.calibration.overviewtextone")),1)]),o[2]||(o[2]=r('<div class="content-img" data-v-e90bd081><img src="./assets/img/robot/payload1.png" alt="" class="inside-img" data-v-e90bd081><img src="./assets/img/robot/payload2.png" alt="" class="inside-img" data-v-e90bd081><img src="./assets/img/robot/payload3.png" alt="" class="inside-img" data-v-e90bd081><img src="./assets/img/robot/payload4.png" alt="" class="inside-img" data-v-e90bd081></div>',1)),i("div",_,[i("div",P,[p(d(u(St).lg("cocontrol.calibration.overviewtextthree"))+" ",1),i("span",q,d(u(St).lg("cocontrol.calibration.overviewtextfour")),1)])])])):6===_t.step&&2===_t.calibrateType?(n(),e("div",C,[i("div",N,[i("span",E,d(u(St).lg("cocontrol.calibration.step"))+"  "+d(_t.step)+" / "+d(_t.lastStep),1),p(" "+d(u(St).lg("cocontrol.calibration.installload")),1)]),i("div",I,[i("div",R,[o[3]||(o[3]=p(" 1） ")),i("span",{innerHTML:u(wt).lang.cocontrol.calibration.installloadtipone},null,8,F)]),i("div",V," 2） "+d(u(St).lg("cocontrol.calibration.installloadtiptwo")),1),i("div",$," 3）"+d(u(St).lg("cocontrol.calibration.installloadtipthree")),1),i("div",{class:"text-div",innerHTML:u(wt).lang.cocontrol.calibration.overviewtexttow},null,8,K),c(Yt,{type:"warning",class:"off-btn",onClick:u(At)},{default:b((()=>[p(d(u(St).lg("cocommon.off")),1)])),_:1},8,["onClick"])])])):7===_t.step&&2===_t.calibrateType?(n(),e("div",z,[i("div",M,[i("span",W,d(u(St).lg("cocontrol.calibration.step"))+"  "+d(_t.step)+" / "+d(_t.lastStep),1),p(" "+d(u(St).lg("cocontrol.calibration.tapesampling")),1)]),i("div",H,[i("div",U,d(u(St).lg("cocontrol.calibration.attention")),1),i("div",D,[(n(),e(g,null,v(4,((t,o)=>{var l;return i("div",{class:"tape-sampling-point",key:"tape-sampling_"+t},[p(d(u(St).lg("cocontrol.calibration.position"))+" "+d(u(wt).lang.cocontrol.calibration[_t.posKey[o]])+"： ",1),i("div",J,[m((n(),x(Yt,{type:"primary"},{default:b((()=>[p(d(u(St).lg("cocontrol.calibration.longpresspoint"))+" "+d(u(wt).lang.cocontrol.calibration[_t.posKey[o]]),1)])),_:2},1024)),[[to,{handler:{down:()=>u(Lt)(function(t){let o={type:"point",icon:"point",id:"pt",label:["P","","位"],status:0,datatype:"value",data:{var:"",path:"/a/b/c",value:{posstat:0,postype:"apos",posvar:{datavar:{default:"DEFAULT",type:"CPOS",value:"DEFAULT"}},posvalue:{apos:{jntpos1:0,jntpos2:0,jntpos3:0,jntpos4:0,jntpos5:0,jntpos6:0,jntpos7:0,exjntpos1:0,exjntpos2:0,exjntpos3:0,exjntpos4:0,exjntpos5:0,exjntpos6:0,exjntpos7:0,exjntpos8:0,exjntpos9:0,exjntpos10:0},cpos:{x:0,y:0,z:0,a:0,b:0,c:0,e:0,poscfg:{mode:-1,cf1:0,cf2:0,cf3:0,cf4:0,cf5:0,cf6:0,cf7:0},exjntpos1:0,exjntpos2:0,exjntpos3:0,exjntpos4:0,exjntpos5:0,exjntpos6:0,exjntpos7:0,exjntpos8:0,exjntpos9:0,exjntpos10:0},dapos:{djntpos1:0,djntpos2:0,djntpos3:0,djntpos4:0,djntpos5:0,djntpos6:0,djntpos7:0,dexjntpos1:0,dexjntpos2:0,dexjntpos3:0,dexjntpos4:0,dexjntpos5:0,dexjntpos6:0,dexjntpos7:0,dexjntpos8:0,dexjntpos9:0,dexjntpos10:0},dcpos:{dx:0,dy:0,dz:0,da:0,db:0,dc:0,de:0,dexjntpos1:0,dexjntpos2:0,dexjntpos3:0,dexjntpos4:0,dexjntpos5:0,dexjntpos6:0,dexjntpos7:0,dexjntpos8:0,dexjntpos9:0,dexjntpos10:0}}}},style:{wa:"520px",ha:"448px",color:"var(--ccf)",icolor:"#ffffff",backgroundColor:"#7d94b5"},ex:{ps:""},path:"/a/b/c",parents:[],children:[],candrop:!0,showchildren:!0,attrshow:!0};return _t.sampling[t].jntPos.forEach(((t,l)=>{o.data.value.posvalue.apos[`jntpos${l+1}`]=t})),o}(o),0)}}]])]),i("div",O,[c(Yt,{loading:_t.btnLoadingArr[o],type:"primary",onClick:t=>function(t,o){_t.btnLoadingArr[o]=!0;let l={jntTargetPos:_t.sampling[o].jntPos,jntActualPos:Kt()};St.ws.cocontrol.wsApi({ty:"Robot/IsOnGivenSamplePositon",db:l}).then((t=>{_t.samplePTextArr[o]=!t.db,t.db?St.ws.cocontrol.wsApi({ty:"Robot/LoadIdenJSSample",db:""}).then((l=>{l.db.errmsg||(t.isSampleAcceptable&&(_t.sampling[o].jntTrqWithLoad=l.db.data),_t.sampleTextArr[o]=!l.db.isSampleAcceptable),_t.btnLoadingArr[o]=!1})):_t.btnLoadingArr[o]=!1}))}(0,o)},{default:b((()=>[_t.btnLoading?(n(),e("span",G,d(u(St).lg("cocontrol.calibration.samplingloading"))+"... ",1)):(n(),e("span",B,d(u(St).lg("cocontrol.calibration.samplingbtn")),1))])),_:2},1032,["loading","onClick"])]),i("div",Q,[_t.samplePTextArr[o]?(n(),e("span",X,d(u(St).lg("cocontrol.calibration.tapesamplingtip")),1)):_t.sampleTextArr[o]?(n(),e("span",Y,d(u(St).lg("cocontrol.calibration.samplingtext")),1)):(null==(l=_t.sampling[o])?void 0:l.jntTrqWithLoad)?(n(),e(g,{key:2},[p(d(u(St).lg("cocontrol.calibration.samplingsuccess")),1)],64)):s("",!0)])])})),64))])])])):_t.step===_t.lastStep?(n(),e("div",Z,[i("div",tt,[i("span",ot,d(u(St).lg("cocontrol.calibration.step"))+"  "+d(_t.step)+" / "+d(_t.lastStep),1),p(" "+d(u(St).lg("cocontrol.calibration.identification")),1)]),i("div",lt,[i("div",at,[p(d(u(St).lg("cocontrol.calibration.toolnumber"))+"： ",1),c(Zt,{modelValue:_t.id,"onUpdate:modelValue":o[1]||(o[1]=t=>_t.id=t),options:_t.numberList,width:"200px",ujt:t.ujt},null,8,["modelValue","options","ujt"])]),i("div",et,[p(d(u(St).lg("cocontrol.calibration.mass"))+"： ",1),i("span",null,d(zt(null==(j=_t.results)?void 0:j.m,1))+" kg",1)]),i("div",nt,[p(d(u(St).lg("cocontrol.calibration.centermass"))+"： ",1),i("span",null,"x："+d(zt(null==(Pt=null==(ht=_t.results)?void 0:ht.pos)?void 0:Pt.mx))+" mm",1),i("span",null,"y："+d(zt(null==(It=null==(Et=_t.results)?void 0:Et.pos)?void 0:It.my))+" mm",1),i("span",null,"z："+d(zt(null==(Mt=null==(Vt=_t.results)?void 0:Vt.pos)?void 0:Mt.mz))+" mm",1)]),2!==_t.calibrateType||(null==(Wt=null==_t?void 0:_t.results)?void 0:Wt.isResultsAcceptable)?s("",!0):(n(),e("div",st,[i("div",it,[p(d(u(St).lg("cocontrol.calibration.maxerror"))+"： ",1),i("span",null,d(u(St).lg("cocontrol.calibration.force"))+"： "+d(zt(null==(Ut=null==(Ht=_t.results)?void 0:Ht.maxError)?void 0:Ut.Force,1))+" N ",1),i("span",null,d(u(St).lg("cocontrol.calibration.torque"))+"： "+d(zt(null==(Jt=null==(Dt=_t.results)?void 0:Dt.maxError)?void 0:Jt.Torque,1))+" Nm ",1)]),i("div",ct,[p(d(u(St).lg("cocontrol.calibration.aveerror"))+"： ",1),i("span",null,d(u(St).lg("cocontrol.calibration.force"))+"： "+d(zt(null==(Gt=null==(Ot=_t.results)?void 0:Ot.aveError)?void 0:Gt.Force,1))+" N ",1),i("span",null,d(u(St).lg("cocontrol.calibration.torque"))+"： "+d(zt(null==(Qt=null==(Bt=_t.results)?void 0:Bt.aveError)?void 0:Qt.Torque,1))+" Nm ",1)])]))])])):(n(),e("div",rt,[i("div",pt,[i("span",dt,d(u(St).lg("cocontrol.calibration.step"))+"  "+d(_t.step)+" / "+d(_t.lastStep),1),2===_t.calibrateType?(n(),e(g,{key:0},[p(d(u(St).lg("cocontrol.calibration.noload")),1)],64)):s("",!0),p(" "+d(u(St).lg("cocontrol.calibration.samplingpos"))+" "+d(u(wt).lang.cocontrol.calibration[_t.posKey[_t.step-2]]),1)]),i("div",ut,[i("div",bt,d(u(wt).lang.cocontrol.calibration["text"+_t.posKey[_t.step-2]]),1),i("div",gt,d(u(wt).lang.cocontrol.calibration["example"+_t.posKey[_t.step-2]]),1),i("div",vt,[i("span",mt,d(u(St).lg("cocontrol.calibration.samplingtip")),1)])]),i("div",xt,[i("img",{src:`./assets/img/robot/payload${_t.step-1}.png`,alt:"",class:"inside-img"},null,8,yt),i("div",jt,[c(Yt,{loading:_t.btnLoading,type:"primary",onClick:$t},{default:b((()=>[_t.btnLoading?(n(),e("span",ft,d(u(St).lg("cocontrol.calibration.samplingloading"))+"... ",1)):(n(),e("span",Tt,d(u(St).lg("cocontrol.calibration.samplingbtn")),1))])),_:1},8,["loading"]),i("div",{class:y({results:!0,"results-err":_t.sampleText})},[_t.sampling[_t.step-2]?(n(),e(g,{key:0},[p(d(u(St).lg("cocontrol.calibration.samplingsuccess")),1)],64)):_t.sampleText?(n(),e(g,{key:1},[p(d(u(St).lg("cocontrol.calibration.samplingtext")),1)],64)):s("",!0)],2)])])])),_t.existTorque?(n(),e("div",kt,[c(Yt,{disabled:0===_t.step,type:"primary",onClick:Ct},{default:b((()=>[p(d(u(St).lg("cocontrol.calibration.beforestep")),1)])),_:1},8,["disabled"]),_t.step===_t.lastStep?(n(),x(Yt,{key:0,type:"primary",onClick:Ft},{default:b((()=>[p(d(u(St).lg("cocontrol.calibration.applied")),1)])),_:1})):_t.loadNextStep?(n(),x(Yt,{key:1,loading:_t.loadNextStep,type:"primary"},{default:b((()=>[p(d(_t.time)+d(u(St).lg("cocontrol.calibration.dnextstep")),1)])),_:1},8,["loading"])):(n(),x(Yt,{key:2,type:"primary",onClick:Nt,disabled:Rt()},{default:b((()=>[p(d(u(St).lg("cocontrol.calibration.nextstep")),1)])),_:1},8,["disabled"]))])):s("",!0)])}}}),[["__scopeId","data-v-e90bd081"]]),St=t({__name:"default",props:{ujt:{}},setup:t=>(t,o)=>(n(),x(wt,{ujt:t.ujt},null,8,["ujt"]))});export{St as _};
