import{d as a,b as l,f as e,r as s,j as t,o as i,F as o,l as n,w as c,n as d,u as r,s as p,q as m,y as u,k as v,z as b,A as h}from"./chunk-asai-BcUlmSst.js";import{_ as y}from"./entry-asai-C1GKnLJc.js";import"./chunk-asai-Dt9XmewB.js";import"./chunk-asai-BEbmHGt4.js";const g={key:0,class:"as-des-main"},f={class:"as-list"},k={class:"main"},w=["onClick"],V={class:"as-li-opt"},x={class:"as-li-opt-li"},D=["onClick"],U=["onClick"],j={class:"as-li-main"},C={class:"as-li-main-li"},_=["onUpdate:modelValue"],A={class:"as-li-main-li"},$=["onUpdate:modelValue"],O={class:"as-li-main-li"},G=["onUpdate:modelValue"],I={class:"as-li-main-li"},W={class:"as-li-main-view"},q=["onUpdate:modelValue"],z=["onUpdate:modelValue"],E={class:"as-li-main-li"},F=["onUpdate:modelValue"],S={class:"add-box"},B={class:"as-li-opt"},H={class:"as-li-main"},J={class:"as-li-main-li"},K={class:"as-li-main-li"},L={class:"as-li-main-li"},M=y(a({__name:"GlobalIndex",props:{ujt:{}},setup(a){const y=a,{$global:M,$dbwork:N,$fn:P}=y.ujt,Q=l({curData:{name:"",val:"",nm:""},tableData:[],wsinfolisten:{ty:"publish/VarUpdate",db:M.user.info.us,tc:0,pb:2},selectedVar:void 0});function R(){if(Q.curData.name){if(Q.tableData.find((a=>Q.curData.name===a.name)))M.msg.fn({type:"err",con:P.lg("cocontrol.var.varpre")});else{let a={};a[Q.curData.name]={val:Q.curData.val,nm:Q.curData.nm},T(a)}}else M.msg.fn({type:"err",con:P.lg("cocontrol.var.varempty")})}function T(a,l=null){P.ws.cocontrol.wsApi({ty:"globalVar/saveVars",db:a}).then((a=>{M.msg.fn({type:"ok",con:P.lg("cocontrol.var.savetips")}),l?l.key=l.name:(Q.tableData.push({...Q.curData,key:Q.curData.name}),Q.curData={name:"",val:"",nm:""})}))}return P.ws.cocontrol.wsApi({ty:"globalVar/getVars",db:""}).then((a=>{Q.tableData=Object.keys(a.db).map((l=>({name:l,key:l,...a.db[l]})))})),Q.wsinfolisten.off=0,P.ws.cocontrol.wsWatch(Q.wsinfolisten,(a=>{console.log(a.db,"publish/varUpdate");for(let l of Object.keys(a.db)){let e=l.split("/");"global"===e[0]&&"var"===e[1]&&Q.tableData.forEach(((s,t)=>{s.name===e[2]&&(Q.tableData[t].val=a.db[l])}))}})),e((()=>{Q.wsinfolisten.off=1,P.ws.cocontrol.wsWatchOff(Q.wsinfolisten)})),(a,l)=>{const e=s("AsSvg");return i(),t(o,null,[n("div",{class:d("globallist"===r(N).prodata.desmenu.global?"as-des-menu-cur":"as-des-menu"),onClick:l[0]||(l[0]=a=>r(N).prodata.desmenu.global="globallist")}," Global ",2),"globallist"===r(N).prodata.desmenu.global?(i(),t("div",g,[n("div",f,[n("div",k,[(i(!0),t(o,null,p(Q.tableData,((a,s)=>(i(),t("div",{class:d({cur:Q.selectedVar===a}),onClick:l=>(a=>{Q.selectedVar=a})(a)},[n("div",V,[n("div",x,m(s+1),1),Q.selectedVar===a?(i(),t("div",{key:0,class:"as-li-opt-li",onClick:u((l=>function(a,l){let e={};e[a.name]={val:a.val,nm:a.nm};let s=[...Q.tableData];s.splice(l,1),s.find((l=>l.name===a.name))?M.msg.fn({type:"err",con:P.lg("cocontrol.var.varpre")}):P.ws.cocontrol.wsApi({ty:"globalVar/removeVars",db:[a.key]}).then((l=>{T(e,a)}))}(a,s)),["stop"])},[v(e,{color:"var(--ch6)",height:"28px",src:"check"})],8,D)):(i(),t("div",{key:1,class:"as-li-opt-li",onClick:u((l=>function(a,l,e){P.ws.cocontrol.wsApi({ty:"globalVar/removeVars",db:[e]}).then((a=>{Q.tableData.splice(l,1),M.msg.fn({type:"ok",con:P.lg("cocontrol.var.deltips")})}))}(0,s,a.key)),["stop"])},[v(e,{color:"var(--ch6)",height:"28px",src:"delete"})],8,U))]),n("div",j,[Q.selectedVar===a?(i(),t(o,{key:0},[n("div",C,[l[4]||(l[4]=n("div",{class:"as-li-label"},"名称：",-1)),b(n("input",{style:{width:"calc(100% - 110px)"},type:"text","onUpdate:modelValue":l=>a.name=l},null,8,_),[[h,a.name]])]),n("div",A,[l[5]||(l[5]=n("div",{class:"as-li-label"},"值：",-1)),b(n("textarea",{style:{width:"calc(100% - 110px)",height:"58px"},"onUpdate:modelValue":l=>a.val=l},"                                ",8,$),[[h,a.val]])]),n("div",O,[l[6]||(l[6]=n("div",{class:"as-li-label"},"备注：",-1)),b(n("textarea",{style:{width:"calc(100% - 110px)",height:"58px"},"onUpdate:modelValue":l=>a.nm=l},"                                ",8,G),[[h,a.nm]])])],64)):(i(),t(o,{key:1},[n("div",I,[l[7]||(l[7]=n("div",{class:"as-li-label"},"名称：",-1)),n("div",W,[b(n("input",{style:{width:"88px"},type:"text","onUpdate:modelValue":l=>a.name=l},null,8,q),[[h,a.name]])]),l[8]||(l[8]=n("div",{class:"as-li-label"},"值：",-1)),b(n("input",{style:{width:"128px"},type:"text","onUpdate:modelValue":l=>a.val=l},null,8,z),[[h,a.val]])]),n("div",E,[l[9]||(l[9]=n("div",{class:"as-li-label"},"备注：",-1)),b(n("input",{style:{width:"calc(100% - 110px)"},type:"text","onUpdate:modelValue":l=>a.nm=l},null,8,F),[[h,a.nm]])])],64))])],10,w)))),256)),n("div",S,[n("div",B,[l[10]||(l[10]=n("div",{class:"as-li-opt-li"},"-",-1)),n("div",{class:"as-li-opt-li",onClick:u(R,["stop"])},[v(e,{color:"var(--ch6)",height:"28px",src:"add"})])]),n("div",H,[n("div",J,[l[11]||(l[11]=n("div",{class:"as-li-label"},"名称：",-1)),b(n("input",{style:{width:"calc(100% - 110px)"},type:"text","onUpdate:modelValue":l[1]||(l[1]=a=>Q.curData.name=a)},null,512),[[h,Q.curData.name]])]),n("div",K,[l[12]||(l[12]=n("div",{class:"as-li-label"},"值：",-1)),b(n("textarea",{style:{width:"calc(100% - 110px)",height:"58px"},"onUpdate:modelValue":l[2]||(l[2]=a=>Q.curData.val=a)},"                            ",512),[[h,Q.curData.val]])]),n("div",L,[l[13]||(l[13]=n("div",{class:"as-li-label"},"备注：",-1)),b(n("textarea",{style:{width:"calc(100% - 110px)",height:"58px"},"onUpdate:modelValue":l[3]||(l[3]=a=>Q.curData.nm=a)},"                            ",512),[[h,Q.curData.nm]])])])])])])])):c("",!0)],64)}}}),[["__scopeId","data-v-2e5f3a62"]]),N={key:0,class:"as-des-area"},P=a({__name:"global",props:{ujt:{}},setup(a){const l=a,{$db:e,$dbwork:s}=l.ujt;return s.prodata.desmenu.global||(s.prodata.desmenu.global="globallist"),(a,l)=>r(e).prodata?(i(),t("div",N,[v(M,{ujt:a.ujt},null,8,["ujt"])])):c("",!0)}});export{P as default};
