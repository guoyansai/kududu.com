import{d as o,b as a,e as t,h as e,I as n,x as l,J as s,j as i,o as d,w as c,l as u,z as r,u as p,F as g,s as m,n as v,q as f,G as k,t as j,r as y,c as h,E as b,k as x,N as L,f as _}from"./chunk-asai-BcUlmSst.js";import{A as E}from"./chunk-asai-BsLDFzi_.js";import{W as w,a as C,b as $,c as T,d as I,m as D,e as M,l as V}from"./chunk-asai-Dt9XmewB.js";import{_ as S}from"./entry-asai-C1GKnLJc.js";import"./chunk-asai-BEbmHGt4.js";const R={class:"monaco-area"},P={key:0,class:"monaco-tools"},A=["onClick"],B=["id"],W={class:"as-lua-menus"},O=["onClick"],U=S(o({__name:"LuaCodeEditor",props:{modelValue:{type:String,default:""},id:{type:String,default:"monacoeditor"},monacoconfig:{type:Object,default:()=>({})},ujt:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(o,{emit:y}){window.MonacoEnvironment={getWorker:(o,a)=>"json"===a?new w:"css"===a||"scss"===a||"less"===a?new C:"html"===a||"handlebars"===a||"razor"===a?new $:"typescript"===a||"javascript"===a?new T:new I};const h=o,{$global:b,$fn:x,$model:L,$ws:_,$dbwork:S}=h.ujt,{initLuaCoding:U}=x.useLuaLanguages(h.ujt);U(1),L.mEditor=null;const N=a({autocoding:{reg:null},autoclosing:{reg:null},color:{reg:null},tips:{reg:null},validation:{reg:null}}),q=t(null),H=a({stat:0,canUndo:!1,canRedo:!1}),z=y,F=e({get:()=>h.modelValue,set(o){H.stat=1,z("update:modelValue",o)}}),{tips:G,insertText:J,undo:K,redo:Q,openFind:X,openReplace:Y,clearHighLight:Z,clearBreakpoint:oo,toggleBreakpoint:ao,addHighLight:to,formatLuaCode:eo,cutText:no,copyText:lo,pasteText:so,delText:io}=x.useLuaEditor(h.ujt),co=[["插入时间",()=>J("\n#set(Time = Power.currentDateTime())")],["插入注释",()=>G()],["剪贴",()=>no(),,1],["复制",()=>lo(),,1],["粘贴",()=>so(D),,1],["删除",()=>io(D),,1],["撤销",()=>K(),!H.canUndo],["重做",()=>Q(),!H.canRedo],["查找",()=>X()],["替换",()=>Y()],["高亮",()=>to(7,D)],["清除高亮",()=>Z()],["清除断点",()=>oo()],["代码格式化",()=>eo(),,1]];n((()=>h.modelValue),((o,a)=>{H.stat?H.stat=0:o!==a&&(null==L?void 0:L.mEditor)&&L.mEditor.setValue(o||"")})),n((()=>{var o,a;return null==(a=null==(o=_.cocontrol)?void 0:o.projectstate)?void 0:a.state}),((o,a)=>{0!=o&&1!=o||a===o||Z()}),{deep:!0,immediate:!0}),n((()=>{var o,a,t,e;return null==(e=null==(t=null==(a=null==(o=null==_?void 0:_.cocontrol)?void 0:o.projectstate)?void 0:a.scripts)?void 0:t[S.prodata.codetk])?void 0:e.line}),((o,a)=>{o&&a!==o&&to(o,D)}),{deep:!0,immediate:!0});let uo=!1;function ro(){var o;h.monacoconfig.language&&(uo&&(null==(o=N.color.reg)||o.dispose()),N.color.reg=V.setMonarchTokensProvider(h.monacoconfig.id,{...h.monacoconfig.language}),uo=!0)}let po=!1;function go(){var o,a;(null==(o=h.monacoconfig.customlanguages.autocoding)?void 0:o.length)&&(po&&(null==(a=N.autocoding.reg)||a.dispose()),N.autocoding.reg=V.registerCompletionItemProvider(h.monacoconfig.id,{provideCompletionItems:(o,a)=>({suggestions:h.monacoconfig.customlanguages.autocoding.filter((o=>null==o?void 0:o.label)).map((o=>({label:o.label,insertText:o.insertText||o.label,detail:o.detail||o.label,kind:V.CompletionItemKind[o.kind||"Function"],insertTextRules:V.CompletionItemInsertTextRule.InsertAsSnippet})))})}),po=!0)}function mo(){var o,a,t;ro(),go(),(null==(a=null==(o=h.monacoconfig.customlanguages)?void 0:o.autoclosing)?void 0:a.length)&&(null==(t=N.autoclosing.reg)||t.dispose(),N.autoclosing.reg=V.setLanguageConfiguration(h.monacoconfig.id,{...h.monacoconfig.config})),function(){var o,a,t;if(null==(a=null==(o=h.monacoconfig.customlanguages)?void 0:o.tips)?void 0:a.length){let o=function(o,a){let t="";return o.forEach((o=>{a==o.text&&(t={contents:[{value:o.title||""},{value:o.content||""}]})})),t};null==(t=N.tips.reg)||t.dispose(),N.tips.reg=V.registerHoverProvider(h.monacoconfig.id,{provideHover:(a,t)=>{if(null!=a.getWordAtPosition(t)){const e=a.getWordAtPosition(t).word;return o([...h.monacoconfig.customlanguages.tips],e)}}})}}(),function(){var o,a,t;(null==(a=null==(o=h.monacoconfig.customlanguages)?void 0:o.validation)?void 0:a.length)&&(null==(t=N.validation.reg)||t.dispose(),N.validation.reg=V.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!0}))}()}function vo(){var o;if(L.mEditor)L.mEditor.setValue(j(F.value));else{const a={value:j(F.value),theme:h.monacoconfig.id,language:h.monacoconfig.id,tabCompletion:"on",formatOnPaste:!0,mouseWheelZoom:!0,folding:!0,autoClosingBrackets:"always",autoClosingDelete:"always",autoClosingOvertype:"always",autoClosingQuotes:"always",autoIndent:"none",automaticLayout:!0,fontSize:32,wordWrap:"on",scrollBeyondLastLine:!0,renderLineHighlight:"all",glyphMargin:!0,minimap:{enabled:!1},contextmenu:!1};(null==(o=q.value)?void 0:o.hasAttribute("data-keybinding-context"))?L.mEditor=M.getEditors()[0]:L.mEditor=M.create(q.value,a)}!function(){var o;null==(o=L.mEditor)||o.onDidChangeModelContent((o=>{var a;const t=null==(a=L.mEditor)?void 0:a.getModel();if(t){if(F.value=t.getValue(),!L.data.sys.configsys.devlevel){const o=function(o,a){var t;try{return null==(t=E)||t.parse(o||""),[]}catch(e){return[{severity:a.MarkerSeverity.Error,message:e.message,startLineNumber:e.line,startColumn:e.column+1,endLineNumber:e.line,endColumn:e.column+2}]}}(j(F.value),D);M.setModelMarkers(t,h.monacoconfig.id,o)}H.canUndo=null==t?void 0:t.canUndo(),H.canRedo=null==t?void 0:t.canRedo()}}))}()}function fo(){L.mEditor&&(L.mEditor.dispose(),L.mEditor=null),Object.values(N).forEach((o=>{o.reg&&o.reg.dispose()})),po=!1}function ko(o){const a=document.querySelector(".monaco-editor"),t=document.querySelector(".as-lua-menus");if(a&&a.contains(o.target)){o.preventDefault();const e={x:o.clientX,y:o.clientY,rect:a.getBoundingClientRect()};b.stat.rightclick=!b.stat.rightclick,t.style.left=(e.x-e.rect.x)/b.scale+"px",t.style.top=(e.y-e.rect.y)/b.scale+"px"}}function jo(){b.stat.rightclick=0}var yo,ho;return b.stat.rightclick=0,h.monacoconfig.init?(fo(),ro(),go(),null==(ho=L.mEditor)||ho.setModel(M.createModel(null==(yo=L.mEditor)?void 0:yo.getValue(),h.monacoconfig.id))):(fo(),M.defineTheme(h.monacoconfig.id,h.monacoconfig.customtheme),V.register({id:h.monacoconfig.id}),mo(),h.monacoconfig.init=1),l((()=>{var o;vo(),null==(o=L.mEditor)||o.onMouseDown((o=>{if(o.target.type===M.MouseTargetType.GUTTER_LINE_NUMBERS){const a=o.target.position.lineNumber;ao(a,D)}})),h.monacoconfig.rightclick&&(document.addEventListener("contextmenu",ko),document.addEventListener("click",jo))})),s((()=>{console.log("b1009002","销毁monaca="+h.id,h.id),h.monacoconfig.rightclick&&(document.removeEventListener("contextmenu",ko),document.removeEventListener("click",jo)),fo()})),(a,t)=>(d(),i("div",R,[p(L).data.sys.configsys.devlevel?(d(),i("div",P,[(d(),i(g,null,m(co,(o=>u("span",{onClick:a=>o[1](),class:v({close:o[2]})},f(o[0]),11,A))),64))])):c("",!0),u("div",{class:"monacoeditor",ref_key:"refEditorDom",ref:q,id:o.id},null,8,B),r(u("div",W,[(d(!0),i(g,null,m(co.filter((o=>null==o?void 0:o[3])),(o=>(d(),i("div",{onClick:a=>o[1](),class:v({"as-lua-li":!0,close:o[2]})},f(o[0]),11,O)))),256))],512),[[k,p(b).stat.rightclick]])]))}}),[["__scopeId","data-v-439ca56c"]]),N=["keys"],q=["onClick"],H={key:0,class:"as-doc-icon"},z={key:0,class:"as-doc-list"},F=["onClick"],G={class:"li"},J=["onClick"],K=S(o({__name:"LuaDocFor",props:{ujt:{},forData:{},langpos:{}},setup(o){const a=o,{$global:t,$dbwork:e,$fn:n}=a.ujt,{insertText:l}=n.useLuaEditor(a.ujt),{getItemLuaByTree:s}=n.useTreeToLua(a.ujt);return(o,r)=>{const k=y("AsSvg");return d(!0),i(g,null,m(o.forData,((r,j)=>(d(),i("div",{keys:r},[["script","op"].includes(j)?c("",!0):(d(),i(g,{key:0},[u("div",{class:"as-doc-tit",onClick:o=>{return a=j,e.prodata.desmenu.doc===a?e.prodata.desmenu.doc="":e.prodata.desmenu.doc=a,void(t.pop.popdoc={});var a}},[p(e).prodata.desmenu.doc===j?(d(),i("div",H,[x(k,{color:"var(--ifc)",height:"28px",src:"common/luadoctit"})])):(d(),h(k,{key:1,color:"var(--ifc)",height:"28px",src:"common/luadoctit"})),b(" "+f(p(n).lg(o.langpos+".class."+j)||j),1)],8,q),p(e).prodata.desmenu.doc===j?(d(),i("div",z,[(d(!0),i(g,null,m(o.forData[j],((e,r)=>{var m,j,y;return d(),i("div",null,[["script","op"].includes(r)?c("",!0):(d(),i(g,{key:0},[u("div",{class:v({lim:!0,cur:(null==(j=null==(m=p(t).pop.popdoc)?void 0:m.data)?void 0:j.key)===r}),onClick:o=>function(o,e){var i,d,c;t.pop.popdoc.stat=1,t.pop.popdoc.tit=(null==(i=n.lg(a.langpos+"."+o))?void 0:i[0])||o,t.pop.popdoc.zindex=1002,t.pop.popdoc.width="600px";const u=(null==(d=n.lg(a.langpos+"."+o))?void 0:d[1])||(null==(c=n.lg(a.langpos+"."+o))?void 0:c[0])||"-";"luadoc"!==a.langpos&&(e=s(o,e)),t.pop.popdoc.btns=[{nm:"关闭",fn:()=>{t.pop.popdoc.stat=0}},{nm:"插入",fn:()=>{l(e),t.pop.popdoc.stat=0}}],t.pop.popdoc.data={key:o,des:u,item:e}}(r,e)},[x(k,{color:"var(--ifc)",height:"28px",src:"common/luadocview"}),b(" "+f((null==(y=p(n).lg(o.langpos+"."+r))?void 0:y[0])||r),1)],10,F),u("div",G,[u("button",{class:"btn",onClick:o=>function(o,t){l("luadoc"===a.langpos?t:s(o,t))}(r,e)},[x(k,{color:"var(--ibg)",height:"28px",src:"common/luadocinset"})],8,J)])],64))])})),256))])):c("",!0)],64))],8,N)))),256)}}}),[["__scopeId","data-v-b1a7891c"]]),Q=S(o({__name:"LuaDoc",props:{ujt:{}},setup(o){var a,e;const n=o,{$dbwork:l,$fn:s,$model:r}=n.ujt,{initWidgets:m}=s.useWidgetsInit(n.ujt);l.prodata.desmenu.doc||(l.prodata.desmenu.doc="doc");const v=t(!1);return(null==(a=r.data)?void 0:a.luadoc)&&(null==(e=Object.keys(r.data.luadoc))?void 0:e.length)?v.value=!0:s.initmodel("cocontrol/luaeditor/luadoc.json").then((o=>{r.data.luadoc=o,m().then((o=>{v.value=!0}))})).catch((o=>{})),(o,a)=>v.value?(d(),i(g,{key:0},[a[0]||(a[0]=u("div",{class:"as-doc-top"},null,-1)),x(K,{ujt:o.ujt,forData:p(r).data.luadoc,langpos:"luadoc"},null,8,["ujt","forData"]),x(K,{ujt:o.ujt,forData:p(l).widgets,langpos:"cowidgets"},null,8,["ujt","forData"])],64)):c("",!0)}}),[["__scopeId","data-v-99caa472"]]),X={class:"as-log-area"},Y={class:"as-log-menu-tit"},Z={key:0,class:"as-log-main"},oo={class:"as-log-list"},ao={class:"li-icon"},to={class:"li"},eo={class:"lim"},no={class:"lim-tm"},lo={class:"lim-des"},so=S(o({__name:"LuaLog",props:{ujt:{}},setup(o){const a=o,{$fn:t,$dbwork:e,$model:n,$ws:l}=a.ujt,{freshLayout:s}=t.useLuaEditor(a.ujt);return e.prodata.desmenu.log||(e.prodata.desmenu.log="log"),(o,a)=>{var t,n;const r=y("AsSvg");return d(),i("div",X,[u("div",{class:"as-log-menu",onClick:a[0]||(a[0]=o=>(e.prodata.desmenu.log="log"===e.prodata.desmenu.log?"":"log",void s()))},[u("div",Y,[x(r,{color:"var(--ibg)",height:"28px",src:"lua/logicon"}),a[1]||(a[1]=b(" 控制台 "))]),u("div",{class:v("as-log-menu-opt"+("log"===p(e).prodata.desmenu.log?"-open":""))},[x(r,{color:"var(--ibg)",height:"28px",src:"lua/logarrow"})],2)]),"log"===p(e).prodata.desmenu.log?(d(),i("div",Z,[u("div",oo,[(d(!0),i(g,null,m((null==(n=null==(t=p(l))?void 0:t.cocontrol)?void 0:n.systemmessage)||[],((o,a)=>(d(),i("div",null,[u("div",ao,[x(r,{color:"var(--ibg)",height:"28px",src:"lua/logli"})]),u("div",to,f(a+1),1),u("div",eo,[u("div",no,f(o.dateTime),1),u("div",lo,f(o.info),1)])])))),256))])])):c("",!0)])}}}),[["__scopeId","data-v-09e231d4"]]),io={class:"as-doc-area"},co={class:"lim"},uo={class:"lic"},ro=S(o({__name:"LuaDocPop",props:{ujt:{}},setup(o){const a=o,{$global:t}=a.ujt;return(o,a)=>(d(),i("div",io,[u("div",co,f(p(t).pop.popdoc.data.des),1),a[0]||(a[0]=u("div",{class:"lit"},"示例",-1)),u("div",uo,f(p(t).pop.popdoc.data.item),1)]))}}),[["__scopeId","data-v-f4429cc2"]]),po={key:0,class:"as-editor-area"},go={key:0,class:"as-editor-doc"},mo={key:1,class:"as-editor-doc-close"},vo={class:"as-editor-code"},fo={key:0,class:"as-editor"},ko={class:"as-editor-log"},jo={key:1},yo=S(o({__name:"LuaEditor",props:{ujt:{}},setup(o){const a=o,{$fn:t,$global:e,$db:n,$dbwork:l}=a.ujt;return l.prodata.desmenu.docstat||(l.prodata.desmenu.docstat="1"),l.prodata.desmenu.codelua||(l.prodata.desmenu.codelua="lua"),(o,a)=>{var t,s,r;const m=y("AsSvg"),v=y("PopBox");return d(),i(g,null,[(null==(t=p(l).prodata.monacoconfig)?void 0:t.id)?(d(),i("div",po,["1"===p(l).prodata.desmenu.docstat?(d(),i("div",go,[x(Q,{ujt:o.ujt},null,8,["ujt"]),u("div",{class:"as-docstat0",onClick:a[0]||(a[0]=o=>p(l).prodata.desmenu.docstat="0")},[x(m,{color:"var(--ict)",height:"28px",src:"bottomarrow"})])])):(d(),i("div",mo,[u("div",{class:"as-docstat1",onClick:a[1]||(a[1]=o=>p(l).prodata.desmenu.docstat="1")},[x(m,{color:"var(--ict)",height:"28px",src:"bottomarrow"})])])),u("div",vo,[p(l).widgets?(d(),i("div",fo,[(d(),h(U,{key:"key"+(null==(s=p(e).location.query)?void 0:s.tk),ujt:o.ujt,id:"id"+(null==(r=p(e).location.query)?void 0:r.tk),monacoconfig:p(l).prodata.monacoconfig,modelValue:p(n).prodata.taskcur,"onUpdate:modelValue":a[2]||(a[2]=o=>p(n).prodata.taskcur=o)},null,8,["ujt","id","monacoconfig","modelValue"]))])):c("",!0),u("div",ko,[x(so,{ujt:o.ujt},null,8,["ujt"])])])])):(d(),i("div",jo,"loading......")),x(v,{ujt:o.ujt,id:"popdoc"},{default:L((()=>[p(e).pop.popdoc.stat?(d(),h(ro,{key:0,ujt:o.ujt},null,8,["ujt"])):c("",!0)])),_:1},8,["ujt"])],64)}}}),[["__scopeId","data-v-8b4f5a50"]]),ho={key:0,class:"as-lua-area"},bo={key:0,class:"as-lua-editor"},xo={key:1},Lo={key:1},_o=S(o({__name:"LuaIndex",props:{ujt:{}},setup(o){const a=o,{$model:t,$fn:e,$db:n,$dbwork:l}=a.ujt,{getLuaConfig:s}=e.useLuaLanguagesInit(a.ujt);return e.initmodel("cocontrol/luaeditor/robotlua.json").then((o=>{l.prodata.monacoconfig=s(o.config),t.data.robotlua={customlanguages:o.customlanguages}})),_((()=>{var o;(null==(o=null==l?void 0:l.prodata)?void 0:o.monacoconfig)&&(l.prodata.monacoconfig=null)})),(o,a)=>{var t;return(null==(t=p(l).prodata.monacoconfig)?void 0:t.id)?(d(),i("div",ho,[p(n).prodata.taskslist?(d(),i("div",bo,[x(yo,{ujt:o.ujt},null,8,["ujt"])])):(d(),i("div",xo,"请选择或新建工程！"))])):(d(),i("div",Lo,"loading......"))}}}),[["__scopeId","data-v-5776c170"]]),Eo=o({__name:"default",props:{ujt:{}},setup(o){const a=o,{$db:t,$dbwork:e}=a.ujt;t.prodata.config.open.pty="lua",e.lua={luahighlight:null,breakpoints:{}};const l=n((()=>t.prodata.taskcur),((o,a)=>{2===e.prodata.saved.taskcur?e.prodata.saved.taskcur=1:o!==a&&0!==e.prodata.saved.taskcur&&(e.prodata.saved.taskcur=0)}));return _((()=>{l&&l(),e.lua&&(e.lua=null)})),(o,a)=>(d(),h(_o,{ujt:o.ujt},null,8,["ujt"]))}});export{Eo as default};
