import{d as s,b as t,r as a,j as e,o as n,k as o,l as i,q as w,u as l,F as r}from"./chunk-asai-B97Ffvgy.js";import{a as c}from"./entry-asai-DWgTTEmF.js";const u={class:"as-ws-area"},d={class:"as-ws-li"},m={class:"as-ws-li-form"},p={class:"as-ws-li-btns"},v={class:"as-ws-li-res"},f={class:"as-ws-li"},j={class:"as-ws-li-form"},k={class:"as-ws-li-btns"},b={class:"as-ws-li-res"},g={class:"as-ws-li"},h={class:"as-ws-li-form"},y={class:"as-ws-li-btns"},W={class:"as-ws-li-res"},C={class:"as-ws-li"},A={class:"as-ws-li-form"},I={class:"as-ws-li-btns"},_={class:"as-ws-li-res"},L={class:"as-ws-li"},$={class:"as-ws-li-form"},D={class:"as-ws-li-btns"},O={class:"as-ws-li-res"},S=c(s({__name:"TestKddWs",props:{ujt:{}},setup(s){const r=s,{$fn:c,$ws:S}=r.ujt;c.useWs(r.ujt,"web").init();c.useWs(r.ujt,"cocontrol").init();c.useWs(r.ujt,"testkdd").init();const q=t({wsserver:"cocontrol",wsnew1:{wsurl:"ws://127.0.0.1:9198",stat:0,wsmsg:'{"id":"wsm9s5aom1qcku87","time":1745304600601,"token":"user:dev","type":"projmanager","action":"readsystemdata","data":""}',timestart:0,timecount:0,timeout:500},wsnew2:{wsurl:"ws://127.0.0.1:9198",stat:0,wsmsg:'{"id":"wsm9s5aom1qcku87","time":1745304600601,"token":"user:dev","type":"projmanager","action":"readsystemdata","data":""}',timestart:0,timecount:0,timeout:500},wsping:{timestart:0,timecount:0,timeout:500},wsapi:{ty:"asaiws/testlisten",db:"aaaabbbb",tc:20,pb:2},wsmock:{ty:"testty/testac"},res:{}});function F(){q.wsping.timestart=Date.now(),c.ws[q.wsserver].wsApi("ping").then((s=>{q.wsping.timecount=Date.now()-q.wsping.timestart}))}function M(s=1){const t=new WebSocket(q["wsnew"+s].wsurl);t.onopen=()=>{q["wsnew"+s].stat=1,console.log("连接成功，准备发送消息"),setInterval((()=>{q["wsnew"+s].timestart=Date.now(),t.send(q["wsnew"+s].wsmsg),console.log(666.001,"ping",q["wsnew"+s].wsmsg)}),q["wsnew"+s].timeout)},t.onmessage=t=>{if("string"==typeof t.data)q["wsnew"+s].timecount=Date.now()-q["wsnew"+s].timestart,console.log(666.002,"pong",t.data);else if(t.data instanceof Blob){const s=new FileReader;s.onload=()=>{console.log("收到二进制消息:",s.result)},s.readAsText(t.data)}},t.onclose=t=>{const a=t.wasClean?`正常关闭（代码: ${t.code}）`:`异常关闭（代码: ${t.code}, 原因: ${t.reason}）`;console.log("连接已关闭:",a),setTimeout((()=>new WebSocket(q["wsnew"+s].wsurl)),5e3)},t.onerror=s=>{console.error("WebSocket 错误:",s),alert("网络连接异常，请检查网络设置！")}}return(s,t)=>{var r;const T=a("AsLink"),x=a("AsaiForm");return n(),e("div",u,[o(T,{ujt:s.ujt},null,8,["ujt"]),i("div",d,[i("div",m,[i("h2",null,w(q.wsnew1.wsurl)+" ("+w(q.wsnew1.stat?"open":"off")+") ",1),o(x,{ujt:s.ujt,asaidata:{data:q.wsnew1}},null,8,["ujt","asaidata"])]),i("div",p,[i("button",{onClick:t[0]||(t[0]=s=>M(1))},"测试连接1")]),i("div",v,[i("h1",null,w(q.wsnew1.timecount)+"ms",1)])]),i("div",f,[i("div",j,[i("h2",null,w(q.wsnew2.wsurl)+" ("+w(q.wsnew2.stat?"open":"off")+") ",1),o(x,{ujt:s.ujt,asaidata:{data:q.wsnew2}},null,8,["ujt","asaidata"])]),i("div",k,[i("button",{onClick:t[1]||(t[1]=s=>M(2))},"测试连接2")]),i("div",b,[i("h1",null,w(q.wsnew2.timecount)+"ms",1)])]),i("div",g,[i("div",h,[i("h2",null,w(q.wsserver)+" ("+w(null==(r=l(S)[q.wsserver])?void 0:r.open)+") ",1),o(x,{ujt:s.ujt,asaidata:{data:q.wsping}},null,8,["ujt","asaidata"])]),i("div",y,[i("button",{onClick:t[2]||(t[2]=s=>F())},"测试PING"),i("button",{onClick:t[3]||(t[3]=s=>{q.wsping.tm?(clearInterval(q.wsping.tm),q.wsping.tm=null):q.wsping.tm=setInterval((()=>{F()}),q.wsping.timeout)})},"测试PING心跳")]),i("div",W,[i("h1",null,w(q.wsping.timecount)+"ms",1)])]),i("div",C,[i("div",A,[o(x,{ujt:s.ujt,asaidata:{data:q.wsapi}},null,8,["ujt","asaidata"])]),i("div",I,[i("button",{onClick:t[4]||(t[4]=s=>{c.ws[q.wsserver].wsApi(q.wsapi).then((s=>{q.res[q.wsapi.ty]=s})).catch((s=>{console.error(666.133,s)}))})},"WsApi"),i("button",{onClick:t[5]||(t[5]=s=>(q.wsapi.off=0,void c.ws[q.wsserver].wsWatch(q.wsapi,(s=>{q.res[q.wsapi.ty]=s}))))},"WsListen"),i("button",{onClick:t[6]||(t[6]=s=>(q.wsapi.off=1,c.ws[q.wsserver].wsWatchOff(q.wsapi),void(q.res[q.wsapi.ty]=null)))},"WsListenOff")]),i("div",_,w(q.res[q.wsapi.ty]),1)]),i("div",L,[i("div",$,[o(x,{ujt:s.ujt,asaidata:{data:q.wsmock}},null,8,["ujt","asaidata"])]),i("div",D,[i("button",{onClick:t[7]||(t[7]=s=>{c.ws[q.wsserver].wsApi(q.wsmock).then((s=>{q.res[q.wsmock.ty]=s})).catch((s=>{console.error(666.233,s)}))})},"Mock"),i("button",{onClick:t[8]||(t[8]=s=>(q.wsmock.off=0,void c.ws[q.wsserver].wsWatch(q.wsmock,(s=>{q.res[q.wsmock.ty]=s}))))},"MockListen"),i("button",{onClick:t[9]||(t[9]=s=>(q.wsmock.off=1,void c.ws[q.wsserver].wsWatchOff(q.wsmock)))},"MockListenOff")]),i("div",O,w(q.res[q.wsmock.ty]),1)])])}}}),[["__scopeId","data-v-10afaca3"]]),q=s({__name:"default",props:{ujt:{}},setup:s=>(s,t)=>{const w=a("UserCard");return n(),e(r,null,[t[0]||(t[0]=i("h1",null,"测试WS",-1)),o(w,{ujt:s.ujt},null,8,["ujt"]),o(S,{ujt:s.ujt},null,8,["ujt"])],64)}});export{q as default};
