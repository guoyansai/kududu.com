import{d as e,e as a,x as l,J as t,r as s,j as n,o as i,l as r,n as o,u,k as c,q as d,F as v,s as p,z as m,G as g,w as f,y as h}from"./chunk-asai-BcUlmSst.js";import{_ as y}from"./entry-asai-C1GKnLJc.js";import"./chunk-asai-Dt9XmewB.js";import"./chunk-asai-BEbmHGt4.js";const x={class:"register-box"},b={class:"register-save-box"},k=["id"],w=["onClick"],V={class:"group-list"},O={class:"group-list-item"},I={class:"group-list-left"},R={class:"group-item-address"},C={class:"title"},j={class:"value"},A=["title"],E=["title"],W={class:"group-item-name"},S={class:"title"},_={class:"value"},M=["title","onClick"],F={class:"button-list"},$=["onClick"],U=["title"],q={class:"title"},G={class:"value"},N=["onClick"],B=["id"],D={class:"button-list"},K=["onClick"],z=["onClick"],J={class:"group-list-right"},P={class:"group-item-type"},H={class:"title"},L=["title"],Q={class:"group-item-rights"},T={class:"title"},X=["title"],Y={class:"group-item-watch"},Z={class:"title"},ee={class:"value"},ae=y(e({__name:"PlcIndex",props:{config:{},ujt:{}},setup(e){let y=e;const{$global:ae,$fn:le,$dbwork:te,$ws:se}=y.ujt,ne=["Int32","UInt32","Float32"];let ie=a([]),re=a(!1),oe=null,ue={keys:{}};l((()=>{te.cocontrol.plc||(te.cocontrol.plc={}),le.ws.cocontrol.wsApi({ty:"RegisterManager/GetRegisterInfo"}).then((e=>{console.log(666.123,e),function(e){let l=!1;ie.value=[],ue.keys={};for(let t in e){let s={name:t,datas:[],display:0==ie.value.length};for(let n=0;n<e[t].length;n++){let i=!1;te.cocontrol.plc.registerManage&&-1!=te.cocontrol.plc.registerManage.indexOf(e[t][n].address)&&(i=!0,l=!0),s.datas.push({originAdd:e[t][n].address,address:be(e[t][n].address),type:e[t][n].type,name:e[t][n].name,permission:e[t][n].permission,renameable:e[t][n].renameable,address2:ve(e[t][n].address,e[t][n].type),rename:e[t][n].name,isOnRename:!1,value:"-",newValue:"-",isWatch:i,isError:!1,isOnValueEdit:!1,intputref:a(),isOnWarning:!1,min:e[t][n].min,max:e[t][n].max}),"Float32"==e[t][n].type?ue.keys[e[t][n].address]={lang:[e[t][n].name,e[t][n].name],rule:{...ce,max:e[t][n].max,min:e[t][n].min,rexin:e[t][n].min>0?"[^0-9.]":"[^0-9-.]"},comp:"RoIoSelect"}:"Bool"==e[t][n].type?ue.keys[e[t][n].address]={lang:[e[t][n].name,e[t][n].name],rule:{...de,max:1,min:0},comp:"RoIoSelect"}:ue.keys[e[t][n].address]={lang:[e[t][n].name,e[t][n].name],rule:{...de,max:e[t][n].max,min:e[t][n].min,rexin:e[t][n].min>0?"[^0-9]":"[^0-9-]"},comp:"RoIoSelect"}}ie.value.push(s)}l&&(oe&&(clearInterval(oe),oe=null),fe())}(e.db)})).catch((e=>{console.error(666.133,e)}))})),t((()=>{oe&&(clearInterval(oe),oe=null)}));const ce={tips:["Input Integer","请输入数字"],require:!0,rex:"",rexin:"",typesys:"",type:"number",comp:"RoIoSelect",unit:"",min:0,max:1023,precision:3},de={tmp:"custominput",rexin:"[^0-9]",step:1,min:1,max:15,hidereplace:!0};function ve(e,a){return-1==ne.indexOf(a)?null:be(e+1)}function pe(e){e.newValue="-",e.newValue="-"==e.value?0:e.value,e.isOnValueEdit=!1}function me(){var e,a;if(!re.value)return;if(4==(null==(a=null==(e=null==se?void 0:se.cocontrol)?void 0:e.robotstatus)?void 0:a.state))return;if(function(){const e=new RegExp(ae.webconfig.varsattr.varkeyrex);let a=!1,l=[],t=[],s=[];for(let n=0;n<ie.value.length;n++)for(let e=0;e<ie.value[n].datas.length;e++)s.push(ie.value[n].datas[e].rename),t.push(ie.value[n].datas[e].name),l.push(ie.value[n].datas[e].originAdd);for(let n=0;n<ie.value.length;n++)for(let i=0;i<ie.value[n].datas.length;i++){if(ie.value[n].datas[i].isError&&(ie.value[n].datas[i].isError=!1),!ie.value[n].datas[i].isOnRename||""==ie.value[n].datas[i].rename)continue;let r=t.indexOf(ie.value[n].datas[i].rename),o=s.indexOf(ie.value[n].datas[i].rename);if(-1!=r){if(ie.value[n].datas[i].originAdd==l[r]){if(-1==t.slice(0,r).concat(t.slice(r+1)).indexOf(ie.value[n].datas[i].rename))continue}a=!0,ge(n,i)}else if(-1!=o){if(ie.value[n].datas[i].originAdd==l[o]){if(-1==s.slice(0,o).concat(s.slice(o+1)).indexOf(ie.value[n].datas[i].rename))continue}a=!0,ge(n,i)}else e.test(ie.value[n].datas[i].rename)||(a=!0,ge(n,i))}return a}())return;let l=[];for(let t=0;t<ie.value.length;t++)for(let e=0;e<ie.value[t].datas.length;e++)ie.value[t].datas[e].renameable&&""!=ie.value[t].datas[e].rename&&l.push({address:ie.value[t].datas[e].originAdd,name:ie.value[t].datas[e].rename});!function(e){let a=le.As.DeepClone(e);le.ws.cocontrol.wsApi({ty:"RegisterManager/SaveRegisterName",db:a}).then((e=>{console.log(666.123,e)})).catch((e=>{console.error(666.133,e)})),function(){for(let e=0;e<ie.value.length;e++)for(let a=0;a<ie.value[e].datas.length;a++)ie.value[e].datas[a].renameable&&(ie.value[e].datas[a].name=ie.value[e].datas[a].rename),ie.value[e].datas[a].isOnRename&&(ie.value[e].datas[a].isOnRename=!1)}()}(l),re.value=!1}function ge(e,a,l){ie.value[e].datas[a].isError=!0}function fe(){clearInterval(oe),oe=null,he(),oe=setInterval((()=>{he()}),500)}function he(){let e=ye();le.ws.cocontrol.wsApi({ty:"RegisterManager/GetRegisterValue",db:e}).then((e=>{console.log(666.123,e),function(e,a){for(let l=0;l<e.length;l++)for(let t=0;t<ie.value.length;t++){let s=!1;for(let n=0;n<ie.value[t].datas.length;n++)if(ie.value[t].datas[n].originAdd==e[l].address){null===e[l][a]?ie.value[t].datas[n][a]="-":ie.value[t].datas[n][a]=e[l][a],s=!0;break}if(s)break}}(e.db,"value")})).catch((e=>{console.error(666.133,e)}))}function ye(){let e=[];for(let a=0;a<ie.value.length;a++)for(let l=0;l<ie.value[a].datas.length;l++)ie.value[a].datas[l].isWatch&&e.push(ie.value[a].datas[l].originAdd);return e}function xe(){for(let e=0;e<ie.value.length;e++)if(ie.value[e].display){for(let a=0;a<ie.value[e].datas.length;a++)pe(ie.value[e].datas[a]);break}}function be(e){let a="";if(0===e)return"0x0000";if(!e)return"-";for(;0!=e;)a=ke(e%16)+a,e=parseInt(e/16+"");return 1==a.length?"0x000"+a:2==a.length?"0x00"+a:3==a.length?"0x0"+a:"0x"+a}function ke(e){switch(e){case 10:return"A";case 11:return"B";case 12:return"C";case 13:return"D";case 14:return"E";case 15:return"F";default:return e}}return(e,a)=>{var l,t,y;const ae=s("AsSvg"),ne=s("el-input"),ue=s("CustomInputNumber"),ce=s("el-switch");return i(),n("div",x,[r("div",b,[r("div",{class:o(["register-save-button",[4!=(null==(y=null==(t=null==(l=u(se))?void 0:l.cocontrol)?void 0:t.robotstatus)?void 0:y.state)&&u(re)?"register-save-active":""]]),onClick:me},[c(ae,{color:"var(--ibg)",height:"28px",src:"projectsave"}),r("span",null,d(u(le).lg("coioplc.savechange")),1)],2)]),(i(!0),n(v,null,p(u(ie),((l,t)=>(i(),n("div",{id:"registerItem"+t},[r("div",{class:o(["group-title",l.display?"":"group-title-line"]),onClick:e=>function(e,a){var l;let t=!1;e.display&&(t=!0);for(let s=0;s<ie.value.length;s++)ie.value[s].display&&(ie.value[s].display=!1);t||(e.display=!0,xe(),null==(l=document.querySelector("#registerItem"+a))||l.scrollIntoView(!1))}(l,t)},[r("span",null,d(l.name),1),r("span",null,[c(ae,{src:"arrowdown",height:"var(--fs4)",color:"var(--ci6)"})])],10,w),m(r("div",V,[(i(!0),n(v,null,p(l.datas,(l=>(i(),n("div",O,[r("div",I,[r("div",R,[r("div",C,d(u(le).lg("coioplc.address")+": "),1),r("div",j,[r("div",{class:o([l.address2?"group-list-inside":""]),title:l.address},d(l.address),11,A),l.address2?(i(),n("div",{key:0,class:"group-list-inside",title:l.address2},d(l.address2),9,E)):f("",!0)])]),r("div",W,[r("div",S,d(u(le).lg("coioplc.name")),1),r("div",_,[l.isOnRename?f("",!0):(i(),n("div",{key:0,class:o([l.renameable?"value-active":""]),title:l.name,onClick:e=>function(e){e.renameable&&(re.value=!0,e.isOnRename=!0)}(l)},d(l.name),11,M)),l.isOnRename?(i(),n("div",{key:1,class:o([l.isError?"value-error":""])},[c(ne,{ref_for:!0,ref:"refFocus",modelValue:l.rename,"onUpdate:modelValue":e=>l.rename=e,onKeydown:a[0]||(a[0]=h((()=>{}),["stop"])),onKeyup:a[1]||(a[1]=h((()=>{}),["stop"]))},null,8,["modelValue","onUpdate:modelValue"]),r("div",F,[r("div",{class:"cancel-button",onClick:e=>function(e){e.rename="",e.rename=e.name,e.isOnRename=!1}(l)},d(u(le).lg("coioplc.cancel")),9,$)])],2)):f("",!0)])]),r("div",{class:"group-item-value",title:l.value},[r("div",q,d(u(le).lg("coioplc.value")+": "),1),r("div",G,[m(r("div",{class:o([l.isWatch?"value-active":""]),onClick:e=>function(e){e.isWatch&&(xe(),e.newValue="-"==e.value?0:e.value,e.isOnValueEdit=!0,e.intputref.getFocus())}(l)},d(l.value),11,N),[[g,!l.isOnValueEdit]]),m(r("div",null,[r("div",{id:l.inputid,class:"value-value-input"},[c(ue,{modelValue:l.newValue,"onUpdate:modelValue":e=>l.newValue=e,ujt:e.ujt,ref_for:!0,ref:e=>l.intputref=e},null,8,["modelValue","onUpdate:modelValue","ujt"])],8,B),r("div",D,[r("div",{class:"save-button",onClick:e=>function(e){if(e.newValue<e.min||e.newValue>e.max)return void(e.isOnWarning=!0);e.isOnWarning=!1;let a={address:e.originAdd,value:Number(e.newValue)};le.ws.cocontrol.wsSend({ty:"RegisterManager/SetRegisterValue",db:a,id:"1"}),e.isOnValueEdit=!1}(l)},d(u(le).lg("coioplc.send")),9,K),r("div",{class:"cancel-button",onClick:e=>pe(l)},d(u(le).lg("coioplc.cancel")),9,z)])],512),[[g,l.isOnValueEdit&&l.isWatch]])])],8,U)]),r("div",J,[r("div",P,[r("div",H,d(u(le).lg("coioplc.type")+": "),1),r("div",{class:"value",title:l.type},d(l.type),9,L)]),r("div",Q,[r("div",T,d(u(le).lg("coioplc.permission")+": "),1),r("div",{class:"value",title:l.permission},d(l.permission),9,X)]),r("div",Y,[r("div",Z,d(u(le).lg("coioplc.monitor")),1),r("div",ee,[c(ce,{disabled:!1,onChange:e=>function(e){e.isWatch=!e.isWatch;let a=!1;for(let t=0;t<ie.value.length;t++){for(let e=0;e<ie.value[t].datas.length;e++)if(ie.value[t].datas[e].isWatch){a=!0;break}if(a)break}!a&&oe?(clearInterval(oe),oe=null):a&&!oe&&fe();let l=ye();te.cocontrol.plc.registerManage=l}(l),"model-value":l.isWatch,"active-text":u(le).lg("coioplc.on"),"inactive-text":u(le).lg("coioplc.off"),"inline-prompt":""},null,8,["onChange","model-value","active-text","inactive-text"])])])])])))),256))],512),[[g,l.display]])],8,k)))),256))])}}}),[["__scopeId","data-v-e13d427c"]]),le={key:0,class:"as-des-area"},te=e({__name:"plc",props:{ujt:{}},setup(e){const a=e,{$db:l,$dbwork:t}=a.ujt;return t.prodata.desmenu.plc||(t.prodata.desmenu.plc="plclist"),(e,a)=>u(l).prodata?(i(),n("div",le,[c(ae,{ujt:e.ujt},null,8,["ujt"])])):f("",!0)}});export{te as default};
