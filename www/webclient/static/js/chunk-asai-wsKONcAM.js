import{d as e,j as a,o as l,n as t,u as o,l as n,e as i,x as s,f as u,r as c,k as r,Y as d,F as p,s as v,z as f,q as m,G as y,w as g,y as h}from"./chunk-asai-BcUlmSst.js";import{_ as b}from"./entry-asai-C1GKnLJc.js";import"./chunk-asai-Dt9XmewB.js";import"./chunk-asai-BEbmHGt4.js";const k=b(e({__name:"fullbackCheckbox",props:{config:{},ujt:{}},setup(e){let i=e;function s(){i.config.isdisabled||i.config.isReadonly&&1!=i.config.force||i.config.callback&&(i.config.isReadonly||i.config.force,i.config.callback({value:"1"==i.config.value?"0":"1",key:i.config.key,force:i.config.force}))}return(e,u)=>(l(),a("div",{class:t(["fullback-checkbox",o(i).config.isdisabled?"full-disabled":"","1"==o(i).config.value?"full-active":"",o(i).config.isReadonly&&1!=o(i).config.force?"full-disabled":""]),onClick:s},u[0]||(u[0]=[n("div",{class:"fullback-inside"},null,-1)]),2))}}),[["__scopeId","data-v-a38f78f6"]]),w={class:"io-box"},O={class:"lock-box"},x=["id"],N=["onClick"],I={class:"group-list"},T={class:"group-list-item"},V={class:"group-list-action"},R=["title"],E={class:"title"},j={class:"value"},C={key:0,class:"group-list-force"},S={class:"title"},_={class:"value"},A={class:"group-list-content"},D={class:"group-list-name"},M={class:"title"},F={class:"value"},U=["title","onClick"],$={class:"name-value-input"},G={class:"button-list"},W=["onClick"],q=["onClick"],K={class:"group-list-value"},P={class:"title"},z={class:"value"},Y={key:0,class:"value-checkbox"},B=["onClick"],H=["id"],J={class:"button-list"},L=["onClick"],Q=["onClick"],X=b(e({__name:"IoIndex",props:{ujt:{}},setup(e){let b=e;const{$fn:X,$global:Z}=b.ujt;let ee=i(!0),ae=i([]),le={keys:{}},te=null;const oe={tips:["Input Integer","请输入数字"],require:!0,rex:"",rexin:"",typesys:"",type:"number",comp:"RoIoSelect",unit:"",min:0,max:1023,precision:3};function ne(){ae.value[0].display=!0,ie()}function ie(){se(),fe(),te=setInterval((()=>{fe()}),500)}function se(){clearInterval(te),te=null}function ue(e){const a={port:e.key,value:Number(e.value),forced:e.force};X.ws.cocontrol.wsSend({ty:"IOManager/SetIOValue",db:a,id:"1"})}function ce(e){e.newValue=0,e.newValue=e.value,e.isOnEdit=!1}function re(e){ee.value||(!function(){for(let e=0;e<ae.value.length;e++)for(let a=0;a<ae.value[e].datas.length;a++)ae.value[e].datas[a].isNameOnEdit&&ye(ae.value[e].datas[a])}(),e.newName=e.name,e.isNewNameError=!1,e.isNameOnEdit=!0)}function de(e){if(""==e.newName)return void(e.isNewNameError=!0);if(function(e){const a=new RegExp(Z.webconfig.varsattr.varkeyrex);let l=!1,t=[],o=[];for(let i=0;i<ae.value.length;i++)for(let e=0;e<ae.value[i].datas.length;e++)o.push(ae.value[i].datas[e].name),t.push(ae.value[i].datas[e].port);let n=o.indexOf(e.newName);-1!=n?t[n]!=e.port&&(l=!0):a.test(e.newName)||(l=!0);return l}(e))return void(e.isNewNameError=!0);let a={port:e.port,name:e.newName};X.ws.cocontrol.wsApi({ty:"IOManager/SetIOName",db:a}).then((e=>{console.log(666.123,e),pe()})).catch((e=>{console.error(666.133,e)})),e.isNameOnEdit=!1}function pe(e){X.ws.cocontrol.wsApi({ty:"IOManager/GetIOInfo",db:""}).then((a=>{!function(e){let a=function(){let e=[],a=[],l=[];for(let t=0;t<ae.value.length;t++)if(ae.value[t].display){e.push(ae.value[t].type);for(let e=0;e<ae.value[t].datas.length;e++)l.push(ae.value[t].datas[e].port),a.push(ae.value[t].datas[e].value)}return{groupDisplay:e,beforeValue:a,beforePort:l}}(),l=0;ae.value=[];for(let t in e){let o=ve(t),n={type:o.type,showType:o.showType,valueType:o.valueType,display:!1,datas:[]};0===l&&0===a.groupDisplay.length&&(n.display=!0),-1!=a.groupDisplay.indexOf(n.type)&&(n.display=!0);for(let l=0;l<e[t].length;l++){let s=null,u=a.beforePort.indexOf(e[t][l].port);-1!=u&&(s=a.beforeValue[u]),"checkbox"==o.showType?n.datas.push({isReadonly:"in"==o.valueType,disabled:ee,force:e[t][l].forced,value:s||0,name:e[t][l].name,newName:"",isNameOnEdit:!1,port:e[t][l].port}):(n.datas.push({isReadonly:"in"==o.valueType,disabled:ee,force:e[t][l].forced,value:s||0,newValue:s||0,name:e[t][l].name,newName:"",min:e[t][l].min,max:e[t][l].max,isNameOnEdit:!1,isOnEdit:!1,isOnWarning:!1,intputref:i(),port:e[t][l].port}),le.keys[e[t][l].name]||(le.keys[e[t][l].name]={lang:[e[t][l].name,e[t][l].name],rule:{...oe,max:e[t][l].max,min:e[t][l].min},comp:"RoIoSelect"}))}ae.value.push(n),l++}}(null==a?void 0:a.db),e&&e()})).catch((e=>{console.error(666.133,e)}))}function ve(e){let a={};switch(e){case"DO":a.type="digitaout",a.showType="checkbox",a.isReadonly=!1,a.valueType="out";break;case"DI":a.type="digitalin",a.showType="checkbox",a.isReadonly=!0,a.valueType="in";break;case"AO":a.type="analogout",a.showType="input",a.isReadonly=!1,a.valueType="out";break;case"AI":a.type="analogin",a.showType="input",a.isReadonly=!0,a.valueType="in";break;case"SimDO":a.type="simdigitalout",a.showType="checkbox",a.isReadonly=!1,a.valueType="out";break;case"SimDI":a.type="simdigitalin",a.showType="checkbox",a.isReadonly=!0,a.valueType="in";break;case"SimAO":a.type="simanalogout",a.showType="input",a.isReadonly=!1,a.valueType="out";break;case"SimAI":a.type="simanalogin",a.showType="input",a.isReadonly=!0,a.valueType="in"}return a}function fe(){let e=function(){let e,a=[];for(let l=0;l<ae.value.length;l++)if(ae.value[l].display){e=l;for(let e=0;e<ae.value[l].datas.length;e++)a.push(ae.value[l].datas[e].port)}return{index:e,params:a}}();e.params.length<=0||X.ws.cocontrol.wsApi({ty:"IOManager/GetIOValue",db:e.params}).then((a=>{console.log(666.123,a),function(e,a){if(0!=a&&!a)return;if(!ae.value[a])return;let l=[];for(let t=0;t<e.length;t++)l.push(e[t].port);for(let t=0;t<ae.value.length;t++)for(let a=0;a<ae.value[t].datas.length;a++){let o=l.indexOf(ae.value[t].datas[a].port);-1!=o&&(ae.value[t].datas[a].value=e[o].value)}}(null==a?void 0:a.db,e.index)})).catch((e=>{console.error(666.133,e)}))}function me(e){for(let a=0;a<ae.value.length;a++)if(ae.value[a].display)for(let l=0;l<ae.value[a].datas.length;l++)e&&"name"==e?ye(ae.value[a].datas[l]):(e&&"value"==e||ye(ae.value[a].datas[l]),ce(ae.value[a].datas[l]))}function ye(e){e.newName="",e.newName=e.name,e.isNameOnEdit=!1}return s((()=>{pe(ne)})),u((()=>{te&&se()})),(e,i)=>{const s=c("el-switch"),u=c("AsSvg"),b=c("el-input"),Z=c("CustomInputNumber");return l(),a("div",w,[n("div",O,[r(s,{modelValue:o(ee),"onUpdate:modelValue":i[0]||(i[0]=e=>d(ee)?ee.value=e:ee=e),"active-text":o(X).lg("coioplc.lock"),"inactive-text":o(X).lg("coioplc.unlock"),"inline-prompt":""},null,8,["modelValue","active-text","inactive-text"])]),(l(!0),a(p,null,v(o(ae),((c,d)=>(l(),a("div",{id:"ioitem"+d},[n("div",{class:t(["group-title",[c.display?"":"group-title-line"]]),onClick:e=>function(e){se(),e.display=!e.display,me(),ie()}(c)},[n("span",null,m(o(X).lg("coioplc."+c.type)),1),n("span",null,[r(u,{src:"arrowdown",height:"var(--fs4)",color:"var(--ci6)"})])],10,N),f(n("div",I,[(l(!0),a(p,null,v(c.datas,((u,d)=>(l(),a("div",T,[n("div",V,[n("div",{class:"group-list-port",title:u.port},[n("div",E,m(o(X).lg("coioplc.ports")+": "),1),n("div",j,m(u.port),1)],8,R),"in"==c.valueType?(l(),a("div",C,[n("div",S,m(o(X).lg("coioplc.force")),1),n("div",_,[r(s,{onChange:e=>function(e){if(ee.value)return;let a={port:e.port,value:1==e.force?0:1};X.ws.cocontrol.wsApi({ty:"IOManager/SetIOForcedFlag",db:a}).then((e=>{console.log(666.123,e),pe()})).catch((e=>{console.error(666.133,e)}))}(u),disabled:o(ee),"model-value":1==u.force,"active-text":o(X).lg("coioplc.on"),"inactive-text":o(X).lg("coioplc.off"),"inline-prompt":""},null,8,["onChange","disabled","model-value","active-text","inactive-text"])])])):g("",!0)]),n("div",A,[n("div",D,[n("div",M,m(o(X).lg("coioplc.name")+": "),1),n("div",F,[!u.isNameOnEdit||u.isNameOnEdit&&o(ee)?(l(),a("div",{key:0,title:u.name,class:t([o(ee)?"":"value-active"]),onClick:e=>re(u)},m(u.name),11,U)):g("",!0),u.isNameOnEdit&&!o(ee)?(l(),a("div",{key:1,class:t([u.isNewNameError?"value-error":""])},[n("div",$,[r(b,{ref_for:!0,ref:"refFocus",modelValue:u.newName,"onUpdate:modelValue":e=>u.newName=e,onKeydown:i[1]||(i[1]=h((()=>{}),["stop"])),onKeyup:i[2]||(i[2]=h((()=>{}),["stop"]))},null,8,["modelValue","onUpdate:modelValue"])]),n("div",G,[n("div",{class:"save-button",onClick:e=>de(u)},m(o(X).lg("coioplc.save")),9,W),n("div",{class:"cancel-button",onClick:e=>ye(u)},m(o(X).lg("coioplc.cancel")),9,q)])],2)):g("",!0)])]),n("div",K,[n("div",P,m(o(X).lg("coioplc.value")+": "),1),n("div",z,["checkbox"==c.showType?(l(),a("div",Y,[r(k,{config:{callback:ue,isReadonly:u.isReadonly,isdisabled:o(ee),force:u.force,key:u.port,value:u.value},ujt:e.ujt},null,8,["config","ujt"])])):g("",!0),"input"==c.showType?(l(),a("div",{key:1,class:t([u.isReadonly&&(!u.isReadonly||1!=u.force)||o(ee)||u.isOnEdit?"":"value-active"])},[f(n("div",{class:t([o(ee)?"input-item-disabled":"",u.isReadonly&&1!=u.force?"input-item-disabled":""]),onClick:e=>function(e){ee.value||e.isReadonly&&1!=e.force||(me("value"),e.newValue=e.value,e.isOnEdit=!0,e.intputref.getFocus())}(u)},m(u.value),11,B),[[y,!u.isOnEdit||o(ee)]]),f(n("div",null,[n("div",{id:u.inputid,class:"value-value-input"},[r(Z,{modelValue:u.newValue,"onUpdate:modelValue":e=>u.newValue=e,ujt:e.ujt},null,8,["modelValue","onUpdate:modelValue","ujt"])],8,H),n("div",J,[n("div",{class:"save-button",onClick:e=>function(e){if(e.newValue<e.min||e.newValue>e.max)return void(e.isOnWarning=!0);e.isOnWarning=!1;const a={port:e.port,value:e.newValue,forced:e.force};X.ws.cocontrol.wsSend({ty:"IOManager/SetIOValue",db:a,id:"1"}),e.isOnEdit=!1}(u)},m(o(X).lg("coioplc.send")),9,L),n("div",{class:"cancel-button",onClick:e=>ce(u)},m(o(X).lg("coioplc.cancel")),9,Q)])],512),[[y,u.isOnEdit&&!o(ee)]])],2)):g("",!0)])])])])))),256))],512),[[y,c.display]])],8,x)))),256))])}}}),[["__scopeId","data-v-817ed8a9"]]),Z={key:0,class:"as-des-area"},ee=e({__name:"io",props:{ujt:{}},setup(e){const t=e,{$db:n,$dbwork:i}=t.ujt;return i.prodata.desmenu.io||(i.prodata.desmenu.io="iolist"),(e,t)=>o(n).prodata?(l(),a("div",Z,[r(X,{ujt:e.ujt},null,8,["ujt"])])):g("",!0)}});export{ee as default};
