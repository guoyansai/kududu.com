var e=Object.defineProperty,t=(t,n,o)=>((t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o)(t,"symbol"!=typeof n?n+"":n,o);import{M as n,a as o,V as a,E as r,b as i,P as s,O as l,B as c,T as d,S as u,c as m,R as g,G as p,A as h,d as f,e as y,D as w,f as b,g as P,h as x,i as C,C as v,j as M,k as T,l as z,F as V,m as S,L as O,n as R,o as E,p as j,q as B,r as L,W as N,s as A,t as I,u as D,v as F,w as k,x as X,y as W,z as _,H as Y}from"./chunk-asai-ly7RqWch.js";import{I as G,d as U,e as Z,x as H,f as Q,j as $,o as q,n as J,Y as K,u as ee}from"./chunk-asai-BcUlmSst.js";import{_ as te}from"./entry-asai-C1GKnLJc.js";function ne(e,t,n){var o,a,r,i;const s=[];for(let l=0;l<t.length;l++){const c=null==(o=t[l])?void 0:o.axis;let d=null==(a=t[l])?void 0:a.name;n&&(d="shadow"+(null==(r=t[l])?void 0:r.name));let u=e[l];0==(null==(i=t[l])?void 0:i.directionFlag)&&(u=u<=0?Math.abs(u):-1*u),s.push({axis:c,name:d,value:ae(u)})}return s}function oe(e,t){e&&(e.x&&(e.x=re(e.x,t)),e.y&&(e.y=re(e.y,t)),e.z&&(e.z=re(e.z,t)),e.a&&(e.a=ae(e.a)),e.b&&(e.b=ae(e.b)),e.c&&(e.c=ae(e.c)))}function ae(e){let t;return t=n.degToRad(e),t}function re(e,t){return e/t}const ie=()=>({DeepClone:function e(t,n=new WeakMap){try{return JSON.parse(JSON.stringify(t))}catch(o){if(null==t||null==t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t);const r=n.get(t);if(r)return r;try{const o=new t.constructor;n.set(t,o);const a=Reflect.ownKeys(t);for(const r of a)o[r]=e(t[r],n);return o}catch(a){return t}}},ToNums:function(e,t=0){return e&&Object.keys(e).forEach((n=>{"number"==typeof e[n]&&(e[n]=function(e,t=0){"number"!=typeof e&&"string"==typeof e&&(e=Number(e));Number.isNaN(e)&&(e=0);e&&t&&(e=Math.round(e*10**t)/10**t);return e}(e[n],t))})),e}});let se={config:null,container:null,scene:null,camera:null,renderer:null,camTarget:null,coordinateGuide:null,modelSize:null,cameraControls:null,curveLineList:null,curvesLine:null,transformControl:null,controlIsDragging:null,modelPostureSnap:null};const le=()=>({getPublicVar:function(e){return se[e]},setPublicVar:function(e,t){se[e]=t},setPublicConfig:function(e){se=e},getPublicConfig:function(e){},clearConfigVars:function(e){switch(e){case"total":!function(){for(const e in se)if(se[e]){if("cameraControls"==e)se[e].dispose(),se.doControlStart&&se[e].removeEventListener("start",se.doControlStart),se.doControlEnd&&se[e].removeEventListener("end",se.doControlEnd);else if("renderer"==e){se[e].forceContextLoss();const t=se[e].getContext();t&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").loseContext(),se[e].clear(),se[e].dispose(),se[e].content=null,se[e].domElement=null}else"scene"==e?(se[e].traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),e=null})),se[e].clear()):"coordinateGuide"==e||"transformControl"==e||"modelPostureSnap"==e?se[e].dispose():"container"==e&&(se[e].innerHTML="");se[e]=null}}();break;case"first":se.container.innerHTML="",se.container=null,se.camera=null,se.renderer=null,se.cameraControls=null,se.environment=null;break;case"second":se.containerSecond.innerHTML="",se.containerSecond=null,se.cameraSecond=null,se.rendererSecond=null,se.cameraControlsSecond=null,se.environmentSecond=null}}}),ce=le();function de(){const e=ce.getPublicVar("camera"),t=ce.getPublicVar("renderer"),n=ce.getPublicVar("camTarget");ce.getPublicVar("cameraControls")&&(ce.getPublicVar("cameraControls").dispose(),ce.getPublicVar("cameraControls").removeEventListener("start",ue),ce.getPublicVar("cameraControls").removeEventListener("end",me),ce.setPublicVar("cameraControls",null));const o=new l(e,t.domElement);o.enableKeys=!1,o.minDistance=1,o.maxDistance=14,o.minPolarAngle=0,o.target=n.clone(),o.maxPolarAngle=Math.PI/1.6,o.update(),ce.setPublicVar("cameraControls",o),o.addEventListener("start",ue),o.addEventListener("end",me)}function ue(){ce.getPublicVar("handleMouseStatus")(!0)}function me(){ce.getPublicVar("handleMouseStatus")(!1)}const ge={initCamera:function(e){let t;t="second"==e?ce.getPublicVar("containerSecond"):ce.getPublicVar("container");const n=new s(50,(null==t?void 0:t.clientWidth)/(null==t?void 0:t.clientHeight),.15,1e5);return n.camTarget=new a(0,0,0),n},initOrbitControls:de,updateCamera:function(e){const t=ce.getPublicVar("scene");if("second"==e){const e=t.getObjectByName("Camera").clone(),n=ce.getPublicVar("containerSecond");e.aspect=(null==n?void 0:n.clientWidth)/(null==n?void 0:n.clientHeight),e.updateProjectionMatrix(),ce.setPublicVar("cameraSecond",e),function(){const e=ce.getPublicVar("camTarget"),t=ce.getPublicVar("cameraSecond"),n=ce.getPublicVar("rendererSecond");ce.getPublicVar("cameraControlsSecond")&&(ce.getPublicVar("cameraControlsSecond").dispose(),ce.getPublicVar("cameraControlsSecond").removeEventListener("start",ue),ce.getPublicVar("cameraControlsSecond").removeEventListener("end",me),ce.setPublicVar("cameraControlsSecond",null));const o=new l(t,n.domElement);o.enableKeys=!1,o.minDistance=1,o.maxDistance=14,o.minPolarAngle=0,o.target=e.clone(),o.maxPolarAngle=Math.PI/1.6,o.update(),ce.setPublicVar("cameraControlsSecond",o),o.addEventListener("start",ue),o.addEventListener("end",me)}()}else{const e=t.getObjectByName("Camera"),n=ce.getPublicVar("container");e.up.set(0,0,1),e.aspect=(null==n?void 0:n.clientWidth)/(null==n?void 0:n.clientHeight),e.updateProjectionMatrix(),ce.setPublicVar("camera",e),de()}},updateCameraTarget:function(e,t){const n=ce.getPublicVar("camTarget");let s=new r(e.a,e.b,e.c,"ZYX"),l=new a(n.x,n.y,n.z),c=(new i).setFromMatrix4((new o).makeRotationFromEuler(s));if(l=l.applyMatrix3(c),"second"==t){const e=ce.getPublicVar("cameraControlsSecond");e.target=new a(l.x,l.y,l.z),e.update()}else{const e=ce.getPublicVar("cameraControls");e.target=new a(l.x,l.y,l.z),e.update()}}},pe=le();function he(){let e=pe.getPublicVar("config").jointInfo;if(!e)return;return e[e.length-1].name}function fe(e,t){e.isObject3D&&e.traverse((e=>{e.visible=Boolean(t)}))}const ye={getModelSize:function(){const e=pe.getPublicVar("scene"),t=e.getObjectByName("Base")||e.getObjectByName("base");if(!t)return null;const n=(new c).expandByObject(t),o=n.getSize(new a);return{center:n.getCenter(new a),x1:o.x,x2:o.x,y1:o.y,y2:o.y,z1:o.z,z2:o.z}},displayObj:fe,getEndWorldPosition:function(){const e=pe.getPublicVar("scene"),t=e.getObjectByName("tool");let n="",o=null;if(t?(n="tool",o=t):(n="link",o=e.getObjectByName(he())),o){const e=o.getWorldPosition(new a);return{type:n,pos:{x:e.x,y:e.y,z:e.z}}}},getIntersectMesh:function(e,t,n){const o=function(e,t){const n=pe.getPublicVar("camera"),o=pe.getPublicVar("container"),a=new g,r=o.getBoundingClientRect(),i=e.clientX/t-r.left/t,s=e.clientY/t-r.top/t,l={x:i/o.offsetWidth*2-1,y:-s/o.offsetHeight*2+1};return a.setFromCamera(l,n),a}(e,n);let a=null;const r=o.intersectObjects(t,!0);for(let i=0;i<r.length;i++){const e=r[i].object.parent;if(e.externalId&&"feature"==e.name){a=e;break}}if(a)return{mesh:a,type:a.groupType}},changeObjectRotation:function(e,t,n){if(t&&t.rotation)switch(e){case"rx":t.rotation.x=n;break;case"ry":t.rotation.y=n;break;case"rz":t.rotation.z=n}},configureObjects:he,clearGeometry:function(e,t){let n=[];!Array.isArray(e)&&e instanceof Object?n.push(e):n=e,n.forEach((e=>{e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose(),t.remove(e)}))},cancelPointLighting:function(e){const t=pe.getPublicVar("scene"),n=t.getObjectByProperty("externalId",e);if(n){const o=n.getObjectByName("heightLight"+e);if(o&&(o.visible=!1),fe(n.getObjectByName("helperAxes"),!1),n.coord){const e=t.getObjectByProperty("externalId",n.coord);e&&(e.getObjectByName("coordMesh").visible=!1)}}},lightingPoint:function(e){const t=pe.getPublicVar("scene"),n=t.getObjectByProperty("externalId",e);if(n){let o=n.getObjectByName("heightLight"+e);if(o?o.visible=!0:function(e){const t=new d,n="./assets/robot/img/heightLight.png",o=t.load(n),a=new u({map:o,color:16777040,transparent:!0,opacity:.9}),r=new m(a);r.scale.set(.1,.1,1),r.name="heightLight"+e.externalId,e.add(r)}(n),fe(n.getObjectByName("helperAxes"),!0),n.coord){const e=t.getObjectByProperty("externalId",n.coord);e&&(e.getObjectByName("coordMesh").visible=!0)}return n}},resizeContainer:function(){const e=pe.getPublicVar("container"),t=pe.getPublicVar("camera"),n=pe.getPublicVar("renderer");t.aspect=e.clientWidth/e.clientHeight,t.updateProjectionMatrix(),n.setSize(e.clientWidth,e.clientHeight),n.setPixelRatio(window.devicePixelRatio)}};function we(e){const t={x:0,y:0,z:0},n=e.hasOwnProperty("position")?e.position:t,o=e.hasOwnProperty("rotation")?e.rotation:t,r=e.hasOwnProperty("name")?e.name:"point",i=e.hasOwnProperty("id")?e.id:"",s=new f(.014,40,40),l=new y({color:16776960,depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!0,transparent:!0,side:w}),c=new b(s,l),d=function(e,t,n){const o=new p;o.name="helperAxes";const r=new a(0,0,0),i=new a(1,0,0),s=new a(0,1,0),l=new a(0,0,1),c=new h(i,r,e,14156044,n,t);c.name="arrowX";const d=new h(s,r,e,4369920,n,t);d.name="arrowY";const u=new h(l,r,e,13794,n,t);return u.name="arrowZ",o.add(c,d,u),o}(.08,.01,.02);d.visible=!1,c.add(d),c.position.set(n.x,n.y,n.z),c.rotation.set(o.z,o.y,o.x,"XYZ"),c.name=r,c.externalId=i,c.groupType="point";const g=function(e){const t=1.2,n=document.createElement("canvas"),o=n.getContext("2d"),a=e.fontsize+"px 思源黑体",r=(e.content||"").toString().split("\n"),i=function(e){const t=document.getElementsByTagName("body")[0],n=document.createElement("div"),o=document.createTextNode("Thisistesting");n.appendChild(o),n.style="font:"+e+"; position:absolute; top:0; left:0;",t.appendChild(n);const a=n.offsetHeight;return t.removeChild(n),a}(a);o.font=a;const s=Math.max.apply(null,r.map((function(e){return Math.ceil(o.measureText(e).width)})));n.width=Math.max(2,P(s)),n.height=Math.max(2,P(i)),o.fillStyle=e.fillStyle,o.textAlign="center",o.font=a,o.textBaseline="top";const l=.5*s,c=.5*(i*t-i);for(let u=0;u<r.length;u++)o.fillText(r[u],l,i*t*u+c);const d=new x(n);d.needsUpdate=!0;const g=new u({map:d,depthTest:!1,depthWrite:!0,side:w,fog:!1,transparent:!0}),p=new m(g),h=e.ratio?e.ratio:14,f=n.width/(e.fontsize*h*3),y=n.height/(e.fontsize*h*3);return p.scale.set(f,y,1),p.center.x=.5*s/n.width,p.center.y=-.4*i/n.height,p}({content:r,fontsize:40,fillStyle:"#000000"});return g.position.set(0,0,0),g.name="label",c.add(g),c}const be="#ef0410",Pe="#42ae00",xe="#0035e2",Ce="#060606",ve=.036,Me=!0,Te=.12;let ze=class extends C{constructor(e){super(),t(this,"name","COORDAXES");const n=new p;n.name="coordMesh";const o=new v(.002,.002,Te,50),a=new y({color:be,transparent:!0,depthTest:!1,depthWrite:!0,side:w}),r=new y({color:Pe,transparent:!0,depthTest:!1,depthWrite:!0,side:w}),i=new y({color:xe,transparent:!0,depthTest:!1,depthWrite:!0,side:w}),s=new b(o,a),l=Se("x",be,ve,Me,e.axisType),c=new b(o,r),d=Se("y",Pe,ve,Me,e.axisType),u=new b(o,i),m=Se("z",xe,ve,Me,e.axisType);if(s.rotation.z=.5*Math.PI,s.position.x=.06,l.rotation.z=-Math.PI/2,l.position.x=.13,c.position.y=.06,d.position.y=.13,u.rotation.x=.5*Math.PI,u.position.z=.06,m.rotation.x=.5*Math.PI,m.position.z=.13,n.add(s,c,u,l,d,m),null==e?void 0:e.isHaveCenter){const e=new f(.004,40,40),t=new y({color:Ce,depthTest:!1,depthWrite:!0,side:w,transparent:!0,opacity:0}),o=new b(e,t);o.name="ball",n.add(o)}if(null==e?void 0:e.content){const t=Ve({content:e.content,fontsize:40,fillStyle:"#060606",pos:e.pos});t.position.set(0,0,0),n.add(t)}this.add(n)}modifyLabel(e){let t=this.getObjectByName("coordtitle");t&&(t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose(),t.removeFromParent());let n=Ve({content:e,fontsize:40,fillStyle:"#060606"}),o=this.getObjectByName("coordMesh");o&&o.add(n)}};function Ve(e){const t=document.createElement("canvas"),n=t.getContext("2d"),o=e.fontsize+"px 思源黑体",a=(e.content||"").toString().split("\n"),r=function(e){const t=document.getElementsByTagName("body")[0],n=document.createElement("div"),o=document.createTextNode("Thisistesting");n.appendChild(o),n.style="font:"+e+"; position:absolute; top:0; left:0;",t.appendChild(n);const a=n.offsetHeight;return t.removeChild(n),a}(o);n.font=o;const i=Math.max.apply(null,a.map((function(e){return Math.ceil(n.measureText(e).width)})));t.width=Math.max(2,P(i)),t.height=Math.max(2,P(r)),n.fillStyle=e.fillStyle,n.textAlign="center",n.font=o,n.textBaseline="top";const s=.5*i,l=.5*(1.2*r-r);for(let u=0;u<a.length;u++)n.fillText(a[u],s,1.2*r*u+l);const c=new x(t);c.needsUpdate=!0;const d=new u({map:c,depthTest:!1,depthWrite:!0,side:w,fog:!1,transparent:!0}),g=new m(d),p=e.ratio?e.ratio:14,h=t.width/(e.fontsize*p*3),f=t.height/(e.fontsize*p*3);return g.scale.set(h,f,1),g.center.x=.5*i/t.width,e.pos&&"bottom"==e.pos?g.center.y=2*r/t.height:g.center.y=-.4*r/t.height,g.name="coordtitle",g}function Se(e,t,n,o,a){let r=600,i=600;a&&(r=1e3,i=1e3);const s=1.5*r,l=1.5*r,c=document.createElement("canvas");c.width=s,c.height=l,c.style.width=r,c.style.height=i;const d=c.getContext("2d");d.fillStyle=t,d.arc(s/2,l/2,(s-.1*s)/2,0,2*Math.PI),d.fill(),d.font="Bold 640px 思源黑体",d.fillStyle=Ce,d.textAlign="center",a?d.fillText(e+"("+a+")",s/2,(l+320)/2):d.fillText(e,s/2,(l+320)/2);const g=new x(c);g.needsUpdate=!0;const p=new u({map:g,sizeAttenuation:o,depthTest:!1}),h=new m(p);return a?h.scale.set(.04,.04,.04):h.scale.set(n,n,n),h}const Oe="#fe3535",Re="#8adb00",Ee="#2c8fff",je=.06,Be=!0,Le=.18,Ne=.02,Ae=.002;class Ie extends C{constructor(e){super(),t(this,"name","COORDAXES");const n=new p;n.name="coordMesh";const o=new v(Ae,Ae,Le,50),a=new y({color:Oe,depthTest:!1,depthWrite:!0,side:w,transparent:!0}),r=new y({color:Re,depthTest:!1,depthWrite:!0,side:w,transparent:!0}),i=new y({color:Ee,depthTest:!1,depthWrite:!0,side:w,transparent:!0}),s=new M(.008,Ne,50),l=new b(o,a),c=new b(s,a),d=Fe("x(W)",Oe,je,Be),u=new b(o,r),m=new b(s,r),g=Fe("y(W)",Re,je,Be),h=new b(o,i),P=new b(s,i),x=Fe("z(W)",Ee,je,Be);if(l.rotation.z=.5*Math.PI,l.position.x=.09,c.rotation.z=-Math.PI/2,c.position.x=.19,d.rotation.z=-Math.PI/2,d.position.x=.238,u.position.y=.09,m.position.y=.19,g.position.y=.238,h.rotation.x=.5*Math.PI,h.position.z=.09,P.rotation.x=.5*Math.PI,P.position.z=.19,x.rotation.x=.5*Math.PI,x.position.z=.22,n.add(l,u,h,c,m,P),n.add(d,g,x),null==e?void 0:e.isHaveCenter){const e=new f(.004,40,40),t=new y({color:"#060606",depthTest:!1}),o=new b(e,t);o.name="ball",n.add(o)}if(null==e?void 0:e.content){const t=De({content:e.content,fontsize:40,fillStyle:"#0f0f0f",pos:e.pos});t.position.set(0,0,0),n.add(t)}this.add(n)}modifyLabel(e){let t=this.getObjectByName("coordtitle");t&&(t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose(),t.removeFromParent());let n=De({content:e,fontsize:40,fillStyle:"#060606"}),o=this.getObjectByName("coordMesh");o&&o.add(n)}}function De(e){const t=document.createElement("canvas"),n=t.getContext("2d"),o=e.fontsize+"px 思源黑体",a=(e.content||"").toString().split("\n"),r=function(e){const t=document.getElementsByTagName("body")[0],n=document.createElement("div"),o=document.createTextNode("Thisistesting");n.appendChild(o),n.style="font:"+e+"; position:absolute; top:0; left:0;",t.appendChild(n);const a=n.offsetHeight;return t.removeChild(n),a}(o);n.font=o;const i=Math.max.apply(null,a.map((function(e){return Math.ceil(n.measureText(e).width)})));t.width=Math.max(2,P(i)),t.height=Math.max(2,P(r)),n.fillStyle=e.fillStyle,n.textAlign="center",n.font=o,n.textBaseline="top";const s=.5*i,l=.5*(1.2*r-r);for(let u=0;u<a.length;u++)n.fillText(a[u],s,1.2*r*u+l);const c=new x(t);c.needsUpdate=!0;const d=new u({map:c,depthTest:!1,depthWrite:!0,side:w,fog:!1,transparent:!0}),g=new m(d),p=e.ratio?e.ratio:14,h=t.width/(e.fontsize*p*3),f=t.height/(e.fontsize*p*3);return g.scale.set(h,f,1),g.center.x=.5*i/t.width,e.pos&&"bottom"==e.pos?g.center.y=2*r/t.height:g.center.y=-.4*r/t.height,g.name="coordtitle",g}function Fe(e,t,n,o){const a=document.createElement("canvas");a.width=1080,a.height=1080,a.style.width=720,a.style.height=720;const r=a.getContext("2d");r.font="Bold 450px 思源黑体",r.fillStyle=t,r.textAlign="center",r.fillText(e,540,652.5);const i=new x(a);i.needsUpdate=!0;const s=new u({map:i,sizeAttenuation:o,depthTest:!1}),l=new m(s);return l.scale.set(n,n,n),l}const ke=.06,Xe=!0;function We(e){const t=e||{},n=t.hasOwnProperty("length")?t.length:.1,o=t.hasOwnProperty("title")?t.title:null,a=new p,r=n,i=.02,s=.004,l=new v(s,s,r,50),c=new M(.008,i,50),d=new y({color:14156044}),u=new y({color:4369920}),m=new y({color:13794}),g=new b(l,d),h=new b(c,d),f=new b(l,u),w=new b(c,u),P=new b(l,m),x=new b(c,m);let C=null,T=null,z=null;return o&&(C=_e("x("+o+")","#ef0410",ke,Xe),T=_e("y("+o+")","#42ae00",ke,Xe),z=_e("z("+o+")","#0035e2",ke,Xe)),g.rotation.z=.5*Math.PI,g.position.x=.5*r,h.rotation.z=-Math.PI/2,h.position.x=r+.01,C&&(C.rotation.z=-Math.PI/2,C.position.x=r+.01+.048),f.position.y=.5*r,w.position.y=r+.01,T&&(T.position.y=r+.01+.048),P.rotation.x=.5*Math.PI,P.position.z=.5*r,x.rotation.x=.5*Math.PI,x.position.z=r+.01,z&&(z.rotation.x=.5*Math.PI,z.position.z=r+.01+.048),a.add(g,f,P,h,w,x),a.add(C,T,z),a}function _e(e,t,n,o){const a=document.createElement("canvas");a.width=900,a.height=900,a.style.width=600,a.style.height=600;const r=a.getContext("2d");r.font="Bold 350px 思源黑体",r.fillStyle=t,r.textAlign="center",r.fillText(e,450,537.5);const i=new x(a);i.needsUpdate=!0;const s=new u({map:i,sizeAttenuation:o,depthTest:!1}),l=new m(s);return l.scale.set(n,n,n),l}const Ye=le();function Ge(e){e&&(e.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose()})),e.removeFromParent())}function Ue(e,t){const n=Ye.getPublicVar("scene").getObjectByName(ye.configureObjects());if(!n)return;const o=We({length:.1,title:"T"});o.name="tcpCoord",o.position.set(t.x,t.y,t.z),o.rotation.set(t.a,t.b,t.c,"ZYX"),o.userData={x:e.x,y:e.y,z:e.z,a:e.a,b:e.b,c:e.c},n.attach(o)}const Ze={handelCoordsMesh:function(e){const t=Ye.getPublicVar("scene"),n=t.getObjectByName("USERCOOR");if(n)!function(e,t){e.userData.x==t.x&&e.userData.y==t.y&&e.userData.z==t.z||(e.position.set(t.x,t.y,t.z),e.userData.x=t.x,e.userData.y=t.y,e.userData.z=t.z,ot.clearTheLine("empty"));e.userData.a==t.a&&e.userData.b==t.b&&e.userData.c==t.c||(e.rotation.set(t.a,t.b,t.c,"ZYX"),e.userData.a=t.a,e.userData.b=t.b,e.userData.c=t.c,ot.clearTheLine("empty"))}(n,e);else{let n=function(e){const t=new ze({isHaveCenter:!0,axisLength:1,space:"world",content:"",pos:"bottom",axisType:"U"});return t.position.set(e.x,e.y,e.z),t.rotation.set(e.a,e.b,e.c,"ZYX"),t.userData={x:e.x,y:e.y,z:e.z,a:e.a,b:e.b,c:e.c},t.name="USERCOOR",t}(e);t.add(n)}},createEndposePointMesh:function(){return we({position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},name:"",id:"endposeOnlyPoint"})},modeifyEndposePoint:function(e){let t=Ye.getPublicVar("scene").getObjectByName("endposeOnlyPoint");t&&(t.position.set(e.x,e.y,e.z),t.rotation.set(e.a,e.b,e.c,"ZYX"))},handelTcpMesh:function(e,t,n){const o=Ye.getPublicVar("scene").getObjectByName("tcpCoord");o?function(e,t,n,o){if(!n||!t)return;(t.x!=e.userData.x||t.y!=e.userData.y||t.z!=e.userData.z||t.a!=e.userData.a||t.b!=e.userData.b||t.c!=e.userData.c||o)&&(Ge(e),ot.clearTheLine("empty"),Ue(t,n))}(o,e,t,n):Ue(e,t)},handelMainRobotCoordMesh:function(e){const t=Ye.getPublicVar("scene");let n=t.getObjectByName("MAINROBOTCOOR");if(n)a=e,(o=n).position.set(a.x,a.y,a.z),o.rotation.set(a.a,a.b,a.c,"ZYX");else{let n=function(e){let t=new p;const n=new ze({isHaveCenter:!0,axisLength:1,space:"world",content:"",axisType:"B"});return t.add(n),t.position.set(e.x,e.y,e.z),t.rotation.set(e.a,e.b,e.c,"ZYX"),t.externalId=e.key,t.name="MAINROBOTCOOR",t}(e);t.add(n)}var o,a},handelWorldCoordMesh:function(){const e=Ye.getPublicVar("scene");let t=e.getObjectByName("WORLDCOOR");t&&Ge(t);let n=function(){const e=new Ie({isHaveCenter:!0,axisLength:1,space:"world",content:"",pos:"bottom"});return e.position.set(0,0,0),e.rotation.set(0,0,0,"ZYX"),e.externalId="WORLDCOOR",e.name="WORLDCOOR",e}();e.add(n)},compareMainRobotCoordData:function(e,t){return!!t&&(e.a==t.a&&e.b==t.b&&e.c==t.c&&e.x==t.x&&e.y==t.y&&e.z==t.z)},createHumanArmsTcp:function(){const e=We({length:.1,title:"T"});e.name="leftTcpCoord",e.rotation.set(0,0,0,"ZYX");let t=new p;const n=We({length:.1,title:"T"});return t.name="rightTcpCoord",n.rotation.set(0,0,Math.PI,"ZYX"),t.add(n),{left:e,right:t}}},He=le(),Qe=14566982,$e=14277081,qe=14277081,Je=4144959,Ke=4013373;function et(){const e=He.getPublicVar("scene").getObjectByName("USERCOOR");if(!e)return;const t=new S,n=new O({color:Qe,opacity:.7,linewidth:1}),o=new R(t,n);o.frustumCulled=!1,o.name="curvesLine",e.add(o),He.setPublicVar("curvesLine",o)}function tt(e){var t,n;const o=He.getPublicVar("curvesLine");if(!o)return;let a=null==(n=null==(t=o.geometry.attributes)?void 0:t.position)?void 0:n.array,r=Array.from(a);const i=r.slice(-3);r=e&&"empty"==e?[]:i,o.geometry.setAttribute("position",new E(new Float32Array(r),3))}function nt(e){const t=He.getPublicVar("config").jointInfo;if(!t)return;let n=["tool"];for(let o=0;o<t.length;o++)n.push(t[o].name);for(let o=0;o<e.length;o++)"Mesh"==e[o].type&&(e[o].material=new F({color:2450936,transparent:!0,opacity:.3,side:w,depthWrite:!0,depthTest:!1})),-1!=n.indexOf(e[o].name)&&(e[o].name="shadow"+e[o].name),e[o].children.length>0&&nt(e[o].children)}const ot={initLight:function(){const e=He.getPublicVar("scene");let t=new D(0);t.name="hLight",e.add(t)},initGround:function(){const e=He.getPublicVar("scene"),t=new b(new T(200,200),new y({color:$e,depthWrite:!0,opacity:.3,transparent:!0}));t.up.set(0,0,1),t.name="Floor",t.receiveShadow=!0,e.add(t);const n=new z(70,100,Je,Je);n.name="floorGrid",n.material.opacity=.4,n.material.transparent=!0,n.rotation.x=Math.PI/2,n.position.z=.002,t.add(n),e.fog=new V(qe,10,40)},updateGroundPos:function(){const e=He.getPublicVar("scene"),t=e.getObjectByName("cart"),n=e.getObjectByName("Floor");if(t){const e=t.getWorldPosition(new a);n.position.set(e.x,e.y,e.z)}else n.position.set(0,0,0)},initRenderer:function(e){let t;t="second"==e?He.getPublicVar("containerSecond"):He.getPublicVar("container");const n=new N({antialias:!0,logarithmicDepthBuffer:!0,alpha:!0,preserveDrawingBuffer:!0});return n.setPixelRatio(window.devicePixelRatio),n.setSize(t.clientWidth,t.clientHeight),n.shadowMap.enabled=!0,n.shadowMapSoft=!0,n.shadowMap.type=A,n.gammaFactore=2.2,n.outputEncoding=I,t.appendChild(n.domElement),n.autoClear=!0,n},initCurves:et,drawTheLine:function(e){var t,n,o,a;if(He.getPublicVar("curvesLine")||et(),!He.getPublicVar("curvesLine"))return;let r=[e.x,e.y,e.z],i=null==(n=null==(t=He.getPublicVar("curvesLine").geometry.attributes)?void 0:t.position)?void 0:n.array;i&&Array.from(i).concat([]).length>=1e4&&(tt(),i=null==(a=null==(o=He.getPublicVar("curvesLine").geometry.attributes)?void 0:o.position)?void 0:a.array);let s=i?Array.from(i).concat(r):[].concat(r);s&&He.getPublicVar("curvesLine").geometry.setAttribute("position",new E(new Float32Array(s),3))},changeThemeColor:function(e,t){const n=He.getPublicVar("scene");let o;if("second"==t){o=He.getPublicVar("rendererSecond");let e=new j(o).fromScene(new B,.04).texture;He.setPublicVar("environmentSecond",e)}else{o=He.getPublicVar("renderer");let e=new j(o).fromScene(new B,.04).texture;He.setPublicVar("environment",e)}const a=n.getObjectByName("Floor"),r=n.getObjectByName("floorGrid");o.clearColor(),"default"==e?(n.background=new L(qe),a.material.color.set($e),r.material=new O({color:Je,opacity:.2,transparent:!0}),n.fog.color.setHex(qe)):"dark"==e&&(n.background=new L(Ke),a.material.color.set(3355443),r.material=new O({color:10526880,opacity:.2,transparent:!0}),n.fog.color.setHex(Ke)),function(e,t){let n=e.getObjectByName("Base");if(!n)return;n.traverse((e=>{"Mesh"==e.type&&("body"==e.material.name?(e.material=new F({color:"dark"==t?6647410:3556707,side:w,metalness:1,roughness:.66}),e.material.name="body",e.material.needsUpdate=!0):"lightband"==e.material.name&&(e.material=new k({color:"dark"==t?6710886:16777215,side:w}),e.material.name="lightband"))}))}(n,e)},clearTheLine:tt,initShadowModel:function(){let e=He.getPublicVar("scene").getObjectByName("Base").clone();e.name="shadowBase",e.visible=!1,nt(e.children);let t=Ze.createEndposePointMesh();const n=ye.getEndWorldPosition();return t.position.set(n.pos.x,n.pos.y,n.pos.z),e.getObjectByName("shadow"+ye.configureObjects()).attach(t),e},updateGroudRot:function(e){He.getPublicVar("scene").getObjectByName("Floor").rotation.set(e.a,e.b,e.c,"ZYX")},resetCurves:function(){const e=He.getPublicVar("scene").getObjectByName("USERCOOR");let t=He.getPublicVar("curvesLine");t&&(t.material.dispose(),t.geometry.dispose(),t.clear(),t.removeFromParent());const n=new S,o=new O({color:Qe,opacity:.7,linewidth:1}),a=new R(n,o);a.frustumCulled=!1,a.name="curvesLine",e.add(a),He.setPublicVar("curvesLine",a)}},at=X.Panel;class rt extends at{constructor(e,t="GPU MS"){super(t,"#f90","#210");let n=!0,o=e.getExtension("EXT_disjoint_timer_query_webgl2");null===o&&(n=!1,o=e.getExtension("EXT_disjoint_timer_query"),null===o&&console.warn("GPUStatsPanel: disjoint_time_query extension not available.")),this.context=e,this.extension=o,this.maxTime=30,this.activeQueries=0,this.startQuery=function(){const e=this.context,t=this.extension;if(null===t)return;let o;n?(o=e.createQuery(),e.beginQuery(t.TIME_ELAPSED_EXT,o)):(o=t.createQueryEXT(),t.beginQueryEXT(t.TIME_ELAPSED_EXT,o)),this.activeQueries++;const a=()=>{let r,i,s;n?(r=e.getQueryParameter(o,e.QUERY_RESULT_AVAILABLE),i=e.getParameter(t.GPU_DISJOINT_EXT),s=e.getQueryParameter(o,e.QUERY_RESULT)):(r=t.getQueryObjectEXT(o,t.QUERY_RESULT_AVAILABLE_EXT),i=e.getParameter(t.GPU_DISJOINT_EXT),s=t.getQueryObjectEXT(o,t.QUERY_RESULT_EXT));const l=1e-6*s;r?(i||this.update(l,this.maxTime),this.activeQueries--):!1===e.isContextLost()&&requestAnimationFrame(a)};requestAnimationFrame(a)},this.endQuery=function(){const e=this.extension,t=this.context;null!==e&&(n?t.endQuery(e.TIME_ELAPSED_EXT):e.endQueryEXT(e.TIME_ELAPSED_EXT))}}}const it=le();const st=e=>{var t;const n=e.hasOwnProperty("container")?e.container:null;let o=e.hasOwnProperty("config")?e.config:null;const r=e.hasOwnProperty("handelModelonload")?e.handelModelonload:()=>{},i=e.hasOwnProperty("handleMouseStatus")?e.handleMouseStatus:()=>{},s=e.hasOwnProperty("robotBaseCoord")?e.robotBaseCoord:null;if(!o||!n)return void console.error("未找到配置文件，无法渲染模型！");if(!n)return;const l=le();let c=null,d=null,u=null,m=null,g=null,p=null,h=0,f=0;const y=l.getPublicVar("scene")?"reload":"initModel";function w(e,t){if(!e||!t){const e=[{key:"controlIsDragging",value:!1},{key:"config",value:o},{key:"camTarget",value:new a(0,0,0)}];for(let t=0;t<e.length;t++)l.setPublicVar(e[t].key,e[t].value)}l.setPublicVar(e,t)}function b(){d="first",l.setPublicVar("container",n),l.setPublicVar("camera",ge.initCamera(d)),l.setPublicVar("renderer",ot.initRenderer(d)),x()}function P(){d="second",l.setPublicVar("containerSecond",n),l.setPublicVar("cameraSecond",ge.initCamera(d)),l.setPublicVar("rendererSecond",ot.initRenderer(d)),x()}function x(){if("second"==d){l.getPublicVar("containerSecond").querySelector("canvas").addEventListener("webglcontextlost",C,!1)}else{l.getPublicVar("container").querySelector("canvas").addEventListener("webglcontextlost",C,!1)}}function C(t){t.preventDefault(),console.warn("场景发生未知错误---webgl上下文发生丢失"),e.handleContextLost&&e.handleContextLost()}function v(){if(!s)return void console.error("当前没有机器人对应的坐标系，无法加载模型");(new Y).load(o.pathUrl,(e=>{const t=l.getPublicVar("scene"),n=e.scene,o=n.getObjectByName("Base"),i=n.getObjectByName("Camera");o.castShadow=!1,o.receiveShadow=!1,i&&l.getPublicVar("scene").add(i);for(let a=0;a<o.children.length;a++){if("Mesh"!=o.children[a].type)continue;"body"==o.children[a].material.name&&(o.children[a].userData.type="mainMesh")}M({a:0,b:0,c:0,mode:0,x:0,y:0,z:0});let c=t.getObjectByName("MAINROBOTCOOR");c.add(o);let u=ot.initShadowModel();u&&c.add(u),function(){Ze.handelWorldCoordMesh(),l.setPublicVar("modelSize",ye.getModelSize());let e=Math.floor(10*Math.abs(l.getPublicVar("modelSize").center.z)-1)/10;w("camTarget",new a(0,0,e>.6?.6:e)),ot.updateGroundPos(),ge.updateCamera(d),ge.updateCameraTarget(s,d),M(s),r("initModel",d)}()}))}function M(e){return!Ze.compareMainRobotCoordData(e,p)&&(Ze.handelMainRobotCoordMesh(e),ot.updateGroudRot(e),p=e,!0)}function T(e){ot.clearTheLine(e)}function z(){cancelAnimationFrame(c),c=null}function V(e){c=requestAnimationFrame(V),f=e-h,f>16.68&&function(){const e=l.getPublicVar("scene"),t=l.getPublicVar("camera"),n=l.getPublicVar("cameraSecond"),o=l.getPublicVar("renderer"),a=l.getPublicVar("rendererSecond");o&&(e.environment=l.getPublicVar("environment"),o.render(e,t));a&&(e.environment=l.getPublicVar("environmentSecond"),a.render(e,n))}(),h=e}if("initModel"==y?(w(),l.setPublicVar("scene",new _),l.setPublicVar("handleMouseStatus",i),l.getPublicVar("container")?P():b(),ot.initGround(),v()):(l.getPublicVar("container")?P():b(),ge.updateCamera(d),ge.updateCameraTarget(s,d)),(null==(t=document.querySelectorAll(".simulate-canvas"))?void 0:t.length)<=1&&V(),"reload"==y){let e=setTimeout((()=>{r("reload",d),clearInterval(e),e=null}),10)}return{onContainerResize:function(){ye.resizeContainer()},clearTheLine:T,playSingleJog:function(e,t,n){const o=l.getPublicVar("scene").getObjectByName(t);o&&ye.changeObjectRotation(e,o,n)},playGroupJog:function(e){for(let t=0;t<e.length;t++){const n=l.getPublicVar("scene").getObjectByName(e[t].name);n&&ye.changeObjectRotation(e[t].axis,n,e[t].value)}},getEndWorldPosition:function(){return ye.getEndWorldPosition()},renderCoords:function(e){Ze.handelCoordsMesh(e)},changeTheTheme:function(e,t){ot.changeThemeColor(e,t)},clearScene:function(e){e&&("second"==d?l.getPublicVar("containerSecond").querySelector("canvas").removeEventListener("webglcontextlost",C,!1):l.getPublicVar("container").querySelector("canvas").removeEventListener("webglcontextlost",C,!1),"total"==e&&(cancelAnimationFrame(c),c=null),l.clearConfigVars(e))},clearModel:function(){const e=l.getPublicVar("scene");ye.clearGeometry(e.getObjectByName("Base"),e),T("empty"),ye.clearGeometry(e.getObjectByName("shadowBase"),e)},reloadModel:function(e){o=e,w("config",o),v()},handelMonitor:function(){if(u){let e=!1;"none"==u.dom.style.display&&(e=!0),g.material.visible=e,u.dom.style.display=e?"block":"none",m.dom.style.display=e?"block":"none"}else g=function(){const e=it.getPublicVar("scene"),t=new W(250);return e.add(t),t}(),u=function(){const e=it.getPublicVar("container"),t=X();t.dom.style.position="absolute";for(let n=0;n<t.dom.children.length;n++)t.dom.children[n].style.width="112px",t.dom.children[n].style.height="68.6px";return e.appendChild(t.dom),t}(),m=function(e){const t=it.getPublicVar("renderer"),n=new rt(t.getContext());return n.dom.style.width="112px",n.dom.style.height="68.6px",e.addPanel(n),n}(u)},changeTheViewSite:function(e){const t=l.getPublicVar("coordinateGuide");t&&t.changeTheViewSite(e)},displayShadowModel:function(e){let t=l.getPublicVar("scene").getObjectByName("shadowBase");t&&e!=t.visible&&(t.visible=e)},resetEndPosePoint:function(e){Ze.modeifyEndposePoint(e)},displayCart:function(){let e=l.getPublicVar("scene").getObjectByName("cart");e&&(e.visible=!e.visible)},renderTcp:function(e,t,n){Ze.handelTcpMesh(e,t,n)},getModelImage:function(){if(l.getPublicVar("modelPostureSnap"))return l.getPublicVar("modelPostureSnap").getImage(l.getPublicVar("scene"),l.getPublicVar("renderer"),l.getPublicVar("container"),l.getPublicVar("camera"))},handelMainRobotCoordDataChange:function(e){let t=M(e);return ge.updateCameraTarget(e,d),t},drawTheLine:function(e){ot.drawTheLine(e)},handelAnimateOn:z,handelAnimateOff:function(){c&&z(),V()}}},lt=["id"],ct=te(U({__name:"model3dIndex",props:{config:{},ujt:{}},setup(e,{expose:t}){let s=e;t({onContainerResize:D,setCoordMesh:N,changeTheTheme:F,changeModelPosture:R,clearScene:I,playGhostMotion:j,setTcpMesh:A,clearLine:function(){z("clearTheLine")},changeTheView:function(e){z("changeTheViewSite",e)},getModelImage:function(){if(!(null==C?void 0:C.getModelImage))return;return C.getModelImage()},handelGpu:function(){z("handelMonitor")},playSingleJog:function(e){z("playSingleJog",e.axis,e.name,e.value)},displayCart:function(){z("displayCart")},renderMainRobotCoord:L,handelSwitchAnimate:function(e){"on"==e?z("handelAnimateOff"):"off"==e&&z("handelAnimateOn")}});const{$global:l,$fn:c,$dbwork:d,$ws:u}=s.ujt,{DeepClone:m,ToNums:g}=ie(),{fkSolver:p}=(()=>{function e(e){var t;if((null==(t=null==e?void 0:e.dh)?void 0:t.length)&&e.apos){let t=0;switch(e.dh.length){case 4:t=n.degToRad(e.apos.jntpos2)>0?0:1;break;case 6:let o=n.degToRad(e.apos.jntpos2),a=n.degToRad(e.apos.jntpos3),r=n.degToRad(e.apos.jntpos4),i=n.degToRad(e.apos.jntpos5);t|=e.dh[2][0]*Math.sin(o)+e.dh[3][0]*Math.sin(o+a)+e.dh[4][2]*Math.sin(-o-a+r)>=0?0:4,Math.sin(a)>=0?t|=0:t|=2,Math.sin(i)>=0?t|=0:t|=1;break;case 7:console.log("暂未实现,尽情期待!");break;default:return null}return t}return null}return{getMode:e,fkSolver:function(t){var i;if((null==(i=null==t?void 0:t.dh)?void 0:i.length)&&t.apos&&t.tool&&t.robotBase){let i=t.dh.length,s=new o;switch(i){case 4:s.makeTranslation(0,0,200);break;case 6:s.identity();break;case 7:console.log("暂未实现,尽情期待!");break;default:return null}for(let e=0;e<i;e++){let r=n.degToRad(t.dh[e][1]),i=n.degToRad(t.dh[e][3]),l=n.degToRad(t.apos["jntpos"+(e+1)]),c=Math.sin(r),d=Math.cos(r),u=Math.sin(i+l),m=Math.cos(i+l),g=new a(m,d*u,c*u),p=new a(-u,d*m,c*m),h=new a(0,-c,d),f=new o;f.makeBasis(g,p,h),f.setPosition(t.dh[e][0],-t.dh[e][2]*c,t.dh[e][2]*d),s.multiply(f)}let l=t.tool.value.TOOL,c=new r(n.degToRad(l.a),n.degToRad(l.b),n.degToRad(l.c),"ZYX"),d=new o;d.makeRotationFromEuler(c),d.setPosition(l.x,l.y,l.z),s.multiply(d);let u=t.robotBase;c=new r(n.degToRad(u.a),n.degToRad(u.b),n.degToRad(u.c),"ZYX");let m=new o;m.makeRotationFromEuler(c),m.setPosition(u.x,u.y,u.z);let g=new o;g.multiplyMatrices(m,s);let p=new a;return c.setFromRotationMatrix(g,"ZYX"),p.setFromMatrixPosition(g),{x:p.x,y:p.y,z:p.z,a:n.radToDeg(c.x),b:n.radToDeg(c.y),c:n.radToDeg(c.z),e:0,poscfg:{cf1:0,cf2:0,cf3:0,cf4:0,cf5:0,cf6:0,cf7:0,mode:e(t)},exjntpos1:0,exjntpos2:0,exjntpos3:0,exjntpos4:0,exjntpos5:0,exjntpos6:0,exjntpos7:0,exjntpos8:0,exjntpos9:0,exjntpos10:0}}return null},line:function(e){let t=new a(e.startCPos.x,e.startCPos.y,e.startCPos.z),s=new a(e.endCPos.x,e.endCPos.y,e.endCPos.z),l=new a(e.middleCPos.x,e.middleCPos.y,e.middleCPos.z),c=new a(e.assistCPos.x,e.assistCPos.y,e.assistCPos.z),d=new a(e.newCPos.x,e.newCPos.y,e.newCPos.z),u=new a;u.subVectors(s,t),u.normalize();let m=new a;m.subVectors(l,t);let g=new a;g.subVectors(c,t);let p=new a;p.crossVectors(u,m);let h=new a;if(h.crossVectors(u,g),p.length()<1e-6||h.length()<1e-6)return console.log("姿态纠正错误,辅助点位于焊缝上!"),"姿态纠正错误,辅助点位于焊缝上!";if(p.crossVectors(m,g),h=g.clone(),p.length()<1e-6&&h.dot(m)>1e-6)return console.log("姿态纠正错误,两辅助点与焊缝起点共线且位于焊缝同侧!"),"姿态纠正错误,两辅助点与焊缝起点共线且位于焊缝同侧!";p=m.clone(),h=g.clone();let f=u.clone();f.multiplyScalar(p.dot(u)),f.negate(),f.add(m);let y=u.clone();if(y.multiplyScalar(h.dot(u)),y.negate(),y.add(g),f.length()<1e-6||y.length()<1e-6)return console.log("姿态纠正错误!"),"姿态纠正错误!";f.normalize(),y.normalize();let w=new a;w.addVectors(f,y),w.normalize();let b=new a;b.crossVectors(w,u);let P=new o;P.makeBasis(u,b,w),P.setPosition(t);let x=new i;x.setFromMatrix4(P),x.transpose();let C=new a;C.setFromMatrixPosition(P),C.applyMatrix3(x).negate();let v=new o;v.setFromMatrix3(x),v.setPosition(C);let M=new r(n.degToRad(e.startCPos.a),n.degToRad(e.startCPos.b),n.degToRad(e.startCPos.c),"ZYX"),T=new o;T.makeRotationFromEuler(M),T.setPosition(t);let z=new r(n.degToRad(e.newCPos.a),n.degToRad(e.newCPos.b),n.degToRad(e.newCPos.c),"ZYX"),V=new o;V.makeRotationFromEuler(z),V.setPosition(d);let S=new o;S.multiplyMatrices(v,T);let O=new i,R=new a;O.setFromMatrix4(S),R.setFromMatrixPosition(S);let E=new o;E.multiplyMatrices(v,V);let j=new i,B=new a;j.setFromMatrix4(E),B.setFromMatrixPosition(E),(null==e?void 0:e.offset)&&(e.offset.x=0,e.offset.y=B.getComponent(1)-R.getComponent(1),e.offset.z=B.getComponent(2)-R.getComponent(2));let L=new i;L=O.clone(),L.transpose();let N=new i;N.multiplyMatrices(j,L);let A=new r;return A.setFromRotationMatrix((new o).setFromMatrix3(N),"ZYX"),(null==e?void 0:e.offset)&&(e.offset.a=n.radToDeg(A.x)),e},circle:function(e){let t=new a(e.startCPos.x,e.startCPos.y,e.startCPos.z),s=new a(e.middleCPos.x,e.middleCPos.y,e.middleCPos.z),l=new a(e.endCPos.x,e.endCPos.y,e.endCPos.z),c=new a(e.newCPos.x,e.newCPos.y,e.newCPos.z),d=new a;d.subVectors(s,t);let u=new a;if(u.subVectors(l,s),d.length()<1e-4||u.length()<1e-4)return console.log("姿态纠正错误,点位距离过近!"),"姿态纠正错误,点位距离过近!";d.normalize(),u.normalize();let m=d.dot(u);m>1&&(m=1),m<-1&&(m=-1);let g=Math.acos(m);if(g<.001&&g>Math.PI-.001)return console.log("姿态纠正错误,三点共线!"),"姿态纠正错误,三点共线!";let p=new a;p.crossVectors(d,u);let h=new a;h.addVectors(t,s),h.multiplyScalar(.5);let f=new a;f.addVectors(s,l),f.multiplyScalar(.5);let y=new i;y.set(d.getComponent(0),d.getComponent(1),d.getComponent(2),u.getComponent(0),u.getComponent(1),u.getComponent(2),p.getComponent(0),p.getComponent(1),p.getComponent(2));let w=new a(d.dot(h),u.dot(f),p.dot(t));y.invert();let b=new a(w.getComponent(0),w.getComponent(1),w.getComponent(2));b.applyMatrix3(y),p.normalize();let P=new a;P.subVectors(t,b),P.normalize();let x=new a;x.crossVectors(p,P),y.set(P.getComponent(0),x.getComponent(0),p.getComponent(0),P.getComponent(1),x.getComponent(1),p.getComponent(1),P.getComponent(2),x.getComponent(2),p.getComponent(2));let C=new a(0,1,0);C.applyMatrix3(y);let v=new i(new r(n.degToRad(e.startCPos.a),n.degToRad(e.startCPos.b),n.degToRad(e.startCPos.c),"ZYX")),M=new a,T=new a,z=new a;v.extractBasis(M,T,z);let V=new a;p.dot(z)<0?V.subVectors(P,p):V.addVectors(P,p),V.normalize();let S=new a;S.crossVectors(V,C);let O=new o;O.makeBasis(C,S,V),O.setPosition(t),y.setFromMatrix4(O),y.transpose();let R=new a;R.setFromMatrixPosition(O),R.applyMatrix3(y).negate();let E=new o;E.setFromMatrix3(y),E.setPosition(R);let j=new r(n.degToRad(e.startCPos.a),n.degToRad(e.startCPos.b),n.degToRad(e.startCPos.c),"ZYX"),B=new o;B.makeRotationFromEuler(j),B.setPosition(t);let L=new r(n.degToRad(e.newCPos.a),n.degToRad(e.newCPos.b),n.degToRad(e.newCPos.c),"ZYX"),N=new o;N.makeRotationFromEuler(L),N.setPosition(c);let A=new o;A.multiplyMatrices(E,B);let I=new i,D=new a;I.setFromMatrix4(A),D.setFromMatrixPosition(A);let F=new o;F.multiplyMatrices(E,N);let k=new i,X=new a;k.setFromMatrix4(F),X.setFromMatrixPosition(F),(null==e?void 0:e.offset)&&(e.offset.x=0,e.offset.y=X.getComponent(1)-D.getComponent(1),e.offset.z=X.getComponent(2)-D.getComponent(2));let W=new i;W=I.clone(),W.transpose();let _=new i;_.multiplyMatrices(k,W);let Y=new r;return Y.setFromRotationMatrix((new o).setFromMatrix3(_),"ZYX"),(null==e?void 0:e.offset)&&(e.offset.a=n.radToDeg(Y.x)),e},getTcpPos:function(e){console.log("---------- input seamPos",e),e.tcpNewCPos.x=.5*(e.seamStartPos.x+e.seamEndPos.x),e.tcpNewCPos.y=.5*(e.seamStartPos.y+e.seamEndPos.y),e.tcpNewCPos.z=.5*(e.seamStartPos.z+e.seamEndPos.z);let t=new a(e.seamStartPos.x,e.seamStartPos.y,e.seamStartPos.z),s=new a(e.seamEndPos.x,e.seamEndPos.y,e.seamEndPos.z),l=new a;l.subVectors(s,t);let c=new a,d=new a(-e.normalVector.x,-e.normalVector.y,-e.normalVector.z);c.crossVectors(d,l),d.crossVectors(l,c),l.normalize(),c.normalize(),d.normalize();let u=l.clone(),m=c.clone(),g=d.clone();console.log("xxxxxxxxxxxxxxxxxxxxxx",u),console.log("yyyyyyyyyyyyyyyyyyyyyy",m),console.log("zzzzzzzzzzzzzzzzzzzzzz",g),console.log("zz.dot(xx)",g.dot(u)),console.log("zz.dot(yy)",g.dot(m)),console.log("xx.dot(yy)",u.dot(m));let p=new r(n.degToRad(e.tcpOriginalCPos.a),n.degToRad(e.tcpOriginalCPos.b),n.degToRad(e.tcpOriginalCPos.c),"ZYX"),h=new o;h.makeRotationFromEuler(p);let f=new i;f.setFromMatrix4(h);let y=new a,w=new a,b=new a;f.extractBasis(y,w,b);let P=b.dot(c);P>1&&(P=1),P<-1&&(P=-1);let x=0,C=new a;C.crossVectors(b,c),C.normalize(),x=C.dot(l)>0?Math.acos(P)+Math.PI/2:Math.acos(P)-Math.PI/2;let v=new o;v.makeRotationAxis(C,x);let M=new i;M.setFromMatrix4(v);let T=new i;T.multiplyMatrices(M,f),T.extractBasis(y,w,b),P=b.dot(d),P>1&&(P=1),P<-1&&(P=-1),x=Math.acos(P),C.crossVectors(b,d),C.normalize(),v.makeRotationAxis(C,x),M.setFromMatrix4(v);let z=new i;z.multiplyMatrices(M,T),v.makeRotationAxis(l,n.degToRad(e.angles.dipAngle)),M.setFromMatrix4(v);let V=new i;V.multiplyMatrices(M,z);let S=new o,O=new i,R=new i;S.makeBasis(l,c,d),O.setFromMatrix4(S),v.makeRotationX(n.degToRad(e.angles.dipAngle)),M.setFromMatrix4(v),R.multiplyMatrices(O,M),R.extractBasis(y,w,b),v.makeRotationAxis(w,n.degToRad(e.angles.pushPullAngle)),M.setFromMatrix4(v);let E=new i;E.multiplyMatrices(M,V),v.makeRotationZ(n.degToRad(e.angles.rollAngle)),M.setFromMatrix4(v);let j=new i;j.multiplyMatrices(E,M),v.setFromMatrix3(j);let B=new r;return B.setFromRotationMatrix(v,"ZYX"),e.tcpNewCPos.a=n.radToDeg(B.x),e.tcpNewCPos.b=n.radToDeg(B.y),e.tcpNewCPos.c=n.radToDeg(B.z),console.log("cartParam.tcpNewCPos",e.tcpNewCPos),e},getSeamPos:function(e,t){let n={startPos:{x:0,y:0,z:0},endPos:{x:0,y:0,z:0},tcpPos:{x:0,y:0,z:0}},o=[e.angleBisector.x*t[3],e.angleBisector.y*t[3],e.angleBisector.z*t[3]],a=e.startPos,r=e.endPos,i=[r.x-a.x,r.y-a.y,r.z-a.z],s=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),l=t[1]/s,c=[i[0]*l,i[1]*l,i[2]*l];return n.startPos={x:a.x+c[0]+o[0],y:a.y+c[1]+o[1],z:a.z+c[2]+o[2]},l=t[2]/s,c=[i[0]*l,i[1]*l,i[2]*l],n.endPos={x:r.x+c[0]+o[0],y:r.y+c[1]+o[1],z:r.z+c[2]+o[2]},n.tcpPos={x:.5*(n.startPos.x+n.endPos.x),y:.5*(n.startPos.y+n.endPos.y),z:.5*(n.startPos.z+n.endPos.z)},n}}})(),h={a:0,b:0,c:0,id:1,x:0,y:0,z:0};let f,y=null,w=null,b=null,P=null,x=Z(),C=null,v=Z(!1),M=Z(!1),T=null;function z(e,t,n,o){v.value&&e&&C&&C[e]&&C[e](t,n,o)}function V(e,t){T=t,v.value=!0,function(){let e;f=new ResizeObserver((()=>{clearTimeout(e),e=setTimeout((()=>{D()}),2)})),f.observe(x.value)}(),F(),"reload"!=e&&(N(),R(),A(),(e=>{let t,n,o;e.$dbwork.simulate||(e.$dbwork.simulate={}),o=G((()=>{var t,n;return null==(n=null==(t=e.$ws.cocontrol)?void 0:t.robotcoordinate)?void 0:n.tool}),(()=>{e.setTcpMesh()}),{deep:!0,immediate:!0}),t=G((()=>{var t,n;return null==(n=null==(t=e.$ws.cocontrol)?void 0:t.robotcoordinate)?void 0:n.user}),(()=>{e.setCoordMesh()}),{deep:!0,immediate:!0}),n=G((()=>{var t,n;return null==(n=null==(t=e.$ws.cocontrol)?void 0:t.robotposture)?void 0:n.joint}),(()=>{e.changeModelPosture()}),{deep:!0,immediate:!0}),e.$fn.ws.cocontrol.wsWatch({ty:"publish/RobotGhost"},(t=>{var n;e.$dbwork.simulate.ghost=null==(n=t.db)?void 0:n.joint,e.playGhostMotion()}))})({$dbwork:d,$ws:u,$fn:c,setCoordMesh:N,setTcpMesh:A,renderMainRobotCoord:L,changeModelPosture:R,playGhostMotion:j}))}function S(e){M.value=e}function O(e){let t;e?(t=m(e),oe(t,y)):t=h;return oe(m(t),y),t}function R(e){var t,n,o,a;if(function(){var e,t;let n=m(null==(t=null==(e=u.cocontrol)?void 0:e.robotposture)?void 0:t.joint);if(!n)return;B(ne(n,P))}(),e)for(let r=0;r<e.length;r++)E(m(e[r]));(null==(n=null==(t=u.cocontrol)?void 0:t.robotposture)?void 0:n.end)&&E(m(null==(a=null==(o=u.cocontrol)?void 0:o.robotposture)?void 0:a.end))}function E(e){oe(e,y),z("drawTheLine",e)}function j(){var e;const t=m(null==(e=d.simulate)?void 0:e.ghost);if(!t)return void z("displayShadowModel",!1);B(ne(t,P,!0)),z("displayShadowModel",!0)}function B(e){e&&z("playGroupJog",e)}function L(){var e,t,n,o,a;let r=null==(a=null==(o=null==(n=null==(t=null==(e=null==d?void 0:d.projectcfg)?void 0:e.setting)?void 0:t.Robot)?void 0:n.Base)?void 0:o.Mechanism)?void 0:a.installWay;if(!r)return;const i=m(r);if(oe(i,y),!(null==C?void 0:C.handelMainRobotCoordDataChange)&&i)return;C.handelMainRobotCoordDataChange(i)&&A(!0)}function N(){var e,t;let n=m(null==(t=null==(e=u.cocontrol)?void 0:e.robotcoordinate)?void 0:t.user);n&&(oe(n,y),z("renderCoords",n))}function A(e){let t,n;c.ws.cocontrol.wsApi({ty:"System/ReadConfig"}).then((o=>{t=m(o.db.setting.Robot.Base.Mechanism.dh),n=m(o.db.setting.Robot.Base.Mechanism.installWay),function(e,t,n){var o,a,r,i;const s=m(null==(a=null==(o=u.cocontrol)?void 0:o.robotcoordinate)?void 0:a.tool),l=O(t),c=m(null==(i=null==(r=u.cocontrol)?void 0:r.robotposture)?void 0:i.joint);if(!l||!e||!s)return;let d={};for(let u=0;u<c.length;u++)d["jntpos"+(u+1)]=c[u];const h=g(p({robotBase:l,dh:e,apos:d,tool:{value:{TOOL:s}}}),6);if(!h)return;let f=m(h);oe(f,y),z("renderTcp",s,f,n)}(t,n,e)})).catch((e=>{console.error(666.133,e)}))}function I(e){z("clearScene",e),C=null}function D(){z("onContainerResize")}function F(){z("changeTheTheme","default",T)}return H((()=>{c.initmodel("cocontrol/3dmodel/3dmodelConfig.json").then((e=>{switch(y=e.ratio,w=e.jointNumber,b=e.axisModel.pathUrl+e.axisModel.fileName,w){case 6:case 4:P=m(e.axisModel.link6Objects)}c.ws.cocontrol.wsApi({ty:"System/ReadConfig"}).then((e=>{var t,n;let o=O(m(e.db.setting.Robot.Base.Mechanism.installWay));C=st({container:x.value,config:{jointNumber:w,jointInfo:P,pathUrl:b,theme:null==(n=null==(t=l.webconfig)?void 0:t.setting)?void 0:n.theme},robotBaseCoord:o,handelModelonload:V,handleMouseStatus:S})||{}})).catch((e=>{console.error(666.133,e)}))}))})),Q((()=>{f&&f.disconnect(),I(T)})),(e,t)=>(q(),$("div",{class:J(["container",[ee(M)?"container-draging":"container-normal","simulate-canvas"]]),ref:e=>K(x)?x.value=e:x=e,id:Math.random()+""},null,10,lt))}}),[["__scopeId","data-v-ed6094c6"]]);export{ct as M};
