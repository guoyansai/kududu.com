var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t,r={exports:{}};var a,o,i,s,c,l,u,p,f={luaparse:n((t||(t=1,a=r,i=r.exports,s=function(e){var n,t,r,a,o;e.version="0.3.1";var i=e.defaultOptions={wait:!1,comments:!0,scope:!1,locations:!1,ranges:!1,onCreateNode:null,onCreateScope:null,onDestroyScope:null,onLocalDeclaration:null,luaVersion:"5.1",encodingMode:"none"};function s(e,n){return n=n||0,e<128?String.fromCharCode(e):e<2048?String.fromCharCode(192|n|e>>6,128|n|63&e):e<65536?String.fromCharCode(224|n|e>>12,128|n|e>>6&63,128|n|63&e):e<1114112?String.fromCharCode(240|n|e>>18,128|n|e>>12&63,128|n|e>>6&63,128|n|63&e):null}function c(e){return function(n){var t=e.exec(n);if(!t)return n;G(null,h.invalidCodeUnit,function(e,n){for(var t=e.toString(16);t.length<n;)t="0"+t;return t}(t[0].charCodeAt(0),4).toUpperCase())}}var l={"pseudo-latin1":{fixup:c(/[^\x00-\xff]/),encodeByte:function(e){return null===e?"":String.fromCharCode(e)},encodeUTF8:function(e){return s(e)}},"x-user-defined":{fixup:c(/[^\x00-\x7f\uf780-\uf7ff]/),encodeByte:function(e){return null===e?"":e>=128?String.fromCharCode(63232|e):String.fromCharCode(e)},encodeUTF8:function(e){return s(e,63232)}},none:{discardStrings:!0,fixup:function(e){return e},encodeByte:function(e){return""},encodeUTF8:function(e){return""}}},u=32,p=64,f=128,d=256;e.tokenTypes={EOF:1,StringLiteral:2,Keyword:4,Identifier:8,NumericLiteral:16,Punctuator:u,BooleanLiteral:64,NilLiteral:f,VarargLiteral:d};var h=e.errors={unexpected:"unexpected %1 '%2' near '%3'",unexpectedEOF:"unexpected symbol near '<eof>'",expected:"'%1' expected near '%2'",expectedToken:"%1 expected near '%2'",unfinishedString:"unfinished string near '%1'",malformedNumber:"malformed number near '%1'",decimalEscapeTooLarge:"decimal escape too large near '%1'",invalidEscape:"invalid escape sequence near '%1'",hexadecimalDigitExpected:"hexadecimal digit expected near '%1'",braceExpected:"missing '%1' near '%2'",tooLargeCodepoint:"UTF-8 value too large near '%1'",unfinishedLongString:"unfinished long string (starting at line %1) near '%2'",unfinishedLongComment:"unfinished long comment (starting at line %1) near '%2'",ambiguousSyntax:"ambiguous syntax (function call x new statement) near '%1'",noLoopToBreak:"no loop to break near '%1'",labelAlreadyDefined:"label '%1' already defined on line %2",labelNotVisible:"no visible label '%1' for <goto>",gotoJumpInLocalScope:"<goto %1> jumps into the scope of local '%2'",cannotUseVararg:"cannot use '...' outside a vararg function near '%1'",invalidCodeUnit:"code unit U+%1 is not allowed in the current encoding mode"},m=e.ast={labelStatement:function(e){return{type:"LabelStatement",label:e}},breakStatement:function(){return{type:"BreakStatement"}},gotoStatement:function(e){return{type:"GotoStatement",label:e}},returnStatement:function(e){return{type:"ReturnStatement",arguments:e}},ifStatement:function(e){return{type:"IfStatement",clauses:e}},ifClause:function(e,n){return{type:"IfClause",condition:e,body:n}},elseifClause:function(e,n){return{type:"ElseifClause",condition:e,body:n}},elseClause:function(e){return{type:"ElseClause",body:e}},whileStatement:function(e,n){return{type:"WhileStatement",condition:e,body:n}},doStatement:function(e){return{type:"DoStatement",body:e}},repeatStatement:function(e,n){return{type:"RepeatStatement",condition:e,body:n}},localStatement:function(e,n){return{type:"LocalStatement",variables:e,init:n}},assignmentStatement:function(e,n){return{type:"AssignmentStatement",variables:e,init:n}},callStatement:function(e){return{type:"CallStatement",expression:e}},functionStatement:function(e,n,t,r){return{type:"FunctionDeclaration",identifier:e,isLocal:t,parameters:n,body:r}},forNumericStatement:function(e,n,t,r,a){return{type:"ForNumericStatement",variable:e,start:n,end:t,step:r,body:a}},forGenericStatement:function(e,n,t){return{type:"ForGenericStatement",variables:e,iterators:n,body:t}},chunk:function(e){return{type:"Chunk",body:e}},identifier:function(e){return{type:"Identifier",name:e}},literal:function(e,n,t){return{type:e=2===e?"StringLiteral":16===e?"NumericLiteral":64===e?"BooleanLiteral":e===f?"NilLiteral":"VarargLiteral",value:n,raw:t}},tableKey:function(e,n){return{type:"TableKey",key:e,value:n}},tableKeyString:function(e,n){return{type:"TableKeyString",key:e,value:n}},tableValue:function(e){return{type:"TableValue",value:e}},tableConstructorExpression:function(e){return{type:"TableConstructorExpression",fields:e}},binaryExpression:function(e,n,t){return{type:"and"===e||"or"===e?"LogicalExpression":"BinaryExpression",operator:e,left:n,right:t}},unaryExpression:function(e,n){return{type:"UnaryExpression",operator:e,argument:n}},memberExpression:function(e,n,t){return{type:"MemberExpression",indexer:n,identifier:t,base:e}},indexExpression:function(e,n){return{type:"IndexExpression",base:e,index:n}},callExpression:function(e,n){return{type:"CallExpression",base:e,arguments:n}},tableCallExpression:function(e,n){return{type:"TableCallExpression",base:e,arguments:n}},stringCallExpression:function(e,n){return{type:"StringCallExpression",base:e,argument:n}},comment:function(e,n){return{type:"Comment",value:e,raw:n}}};function v(e){if(ie){var n=se.pop();n.complete(),n.bless(e)}return t.onCreateNode&&t.onCreateNode(e),e}var g=Array.prototype.slice,y=function(e,n){for(var t=0,r=e.length;t<r;++t)if(e[t]===n)return t;return-1};function b(e){var n=g.call(arguments,1);return e=e.replace(/%(\d)/g,(function(e,t){return""+n[t-1]||""}))}Array.prototype.indexOf&&(y=function(e,n){return e.indexOf(n)});var x,S,C,E,w,A,L,k,O,D,N,T=function(e){for(var n,t,r=g.call(arguments,1),a=0,o=r.length;a<o;++a)for(t in n=r[a])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e};function I(e){return Object.create?Object.create(e,{line:{writable:!0,value:e.line},index:{writable:!0,value:e.index},column:{writable:!0,value:e.column}}):e}function G(e){var n,t,r=b.apply(null,g.call(arguments,1));throw null===e||void 0===e.line?(t=x-k+1,(n=I(new SyntaxError(b("[%1:%2] %3",L,t,r)))).index=x,n.line=L,n.column=t):(t=e.range[0]-e.lineStart,(n=I(new SyntaxError(b("[%1:%2] %3",e.line,t,r)))).line=e.line,n.index=e.range[0],n.column=t),n}function V(e){var t=n.slice(e.range[0],e.range[1]);return t||e.value}function B(e,n){G(n,h.expectedToken,e,V(n))}function F(e){var n=V(E);if(void 0!==e.type){var t;switch(e.type){case 2:t="string";break;case 4:t="keyword";break;case 8:t="identifier";break;case 16:t="number";break;case u:t="symbol";break;case 64:t="boolean";break;case f:return G(e,h.unexpected,"symbol","nil",n);case 1:return G(e,h.unexpectedEOF)}return G(e,h.unexpected,t,V(e),n)}return G(e,h.unexpected,"symbol",e,n)}function U(){for(P();45===n.charCodeAt(x)&&45===n.charCodeAt(x+1);)J(),P();if(x>=r)return{type:1,value:"<eof>",line:L,lineStart:k,range:[x,x]};var e,t,i,s=n.charCodeAt(x),c=n.charCodeAt(x+1);if(A=x,function(e){return e>=65&&e<=90||e>=97&&e<=122||95===e||!!(a.extendedIdentifiers&&e>=128)}(s))return function(){for(var e,t;Z(n.charCodeAt(++x)););return function(e){switch(e.length){case 2:return"do"===e||"if"===e||"in"===e||"or"===e;case 3:return"and"===e||"end"===e||"for"===e||"not"===e;case 4:return"else"===e||"then"===e||!(!a.labels||a.contextualGoto)&&"goto"===e;case 5:return"break"===e||"local"===e||"until"===e||"while"===e;case 6:return"elseif"===e||"repeat"===e||"return"===e;case 8:return"function"===e}return!1}(e=o.fixup(n.slice(A,x)))?t=4:"true"===e||"false"===e?(t=p,e="true"===e):"nil"===e?(t=f,e=null):t=8,{type:t,value:e,line:L,lineStart:k,range:[A,x]}}();switch(s){case 39:case 34:return function(){for(var e,t=n.charCodeAt(x++),a=L,i=k,s=x,c=o.discardStrings?null:"";t!==(e=n.charCodeAt(x++));)if((x>r||H(e))&&(c+=n.slice(s,x-1),G(null,h.unfinishedString,n.slice(A,x-1))),92===e){if(!o.discardStrings){var l=n.slice(s,x-1);c+=o.fixup(l)}var u=W();o.discardStrings||(c+=u),s=x}return o.discardStrings||(c+=o.encodeByte(null),c+=o.fixup(n.slice(s,x-1))),{type:2,value:c,line:a,lineStart:i,lastLine:L,lastLineStart:k,range:[A,x]}}();case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return K();case 46:return Q(c)?K():46===c?46===n.charCodeAt(x+2)?{type:d,value:"...",line:L,lineStart:k,range:[A,x+=3]}:M(".."):M(".");case 61:return M(61===c?"==":"=");case 62:return a.bitwiseOperators&&62===c?M(">>"):M(61===c?">=":">");case 60:return a.bitwiseOperators&&60===c?M("<<"):M(61===c?"<=":"<");case 126:if(61===c)return M("~=");if(!a.bitwiseOperators)break;return M("~");case 58:return a.labels&&58===c?M("::"):M(":");case 91:return 91===c||61===c?(e=L,t=k,!1===(i=R(!1))&&G(S,h.expected,"[",V(S)),{type:2,value:o.discardStrings?null:o.fixup(i),line:e,lineStart:t,lastLine:L,lastLineStart:k,range:[A,x]}):M("[");case 47:return a.integerDivision&&47===c?M("//"):M("/");case 38:case 124:if(!a.bitwiseOperators)break;case 42:case 94:case 37:case 44:case 123:case 125:case 93:case 40:case 41:case 59:case 35:case 45:case 43:return M(n.charAt(x))}return F(n.charAt(x))}function j(){var e=n.charCodeAt(x),t=n.charCodeAt(x+1);return!!H(e)&&(10===e&&13===t&&++x,13===e&&10===t&&++x,++L,k=++x,!0)}function P(){for(;x<r;)if(X(n.charCodeAt(x)))++x;else if(!j())break}function M(e){return x+=e.length,{type:u,value:e,line:L,lineStart:k,range:[A,x]}}function K(){var e=n.charAt(x),t=n.charAt(x+1),r="0"===e&&"xX".indexOf(t||null)>=0?function(){var e,t,r,a,o=0,i=1,s=1;for(a=x+=2,Y(n.charCodeAt(x))||G(null,h.malformedNumber,n.slice(A,x));Y(n.charCodeAt(x));)++x;e=parseInt(n.slice(a,x),16);var c=!1;if("."===n.charAt(x)){for(c=!0,t=++x;Y(n.charCodeAt(x));)++x;o=n.slice(t,x),o=t===x?0:parseInt(o,16)/Math.pow(16,x-t)}var l=!1;if("pP".indexOf(n.charAt(x)||null)>=0){for(l=!0,++x,"+-".indexOf(n.charAt(x)||null)>=0&&(s="+"===n.charAt(x++)?1:-1),r=x,Q(n.charCodeAt(x))||G(null,h.malformedNumber,n.slice(A,x));Q(n.charCodeAt(x));)++x;i=n.slice(r,x),i=Math.pow(2,i*s)}return{value:(e+o)*i,hasFractionPart:c||l}}():function(){for(;Q(n.charCodeAt(x));)++x;var e=!1;if("."===n.charAt(x))for(e=!0,++x;Q(n.charCodeAt(x));)++x;var t=!1;if("eE".indexOf(n.charAt(x)||null)>=0)for(t=!0,++x,"+-".indexOf(n.charAt(x)||null)>=0&&++x,Q(n.charCodeAt(x))||G(null,h.malformedNumber,n.slice(A,x));Q(n.charCodeAt(x));)++x;return{value:parseFloat(n.slice(A,x)),hasFractionPart:e||t}}(),o=function(){if(a.imaginaryNumbers)return"iI".indexOf(n.charAt(x)||null)>=0&&(++x,!0)}();return function(){if(a.integerSuffixes)if("uU".indexOf(n.charAt(x)||null)>=0)if(++x,"lL".indexOf(n.charAt(x)||null)>=0){if(++x,"lL".indexOf(n.charAt(x)||null)>=0)return++x,"ULL";G(null,h.malformedNumber,n.slice(A,x))}else G(null,h.malformedNumber,n.slice(A,x));else if("lL".indexOf(n.charAt(x)||null)>=0){if(++x,"lL".indexOf(n.charAt(x)||null)>=0)return++x,"LL";G(null,h.malformedNumber,n.slice(A,x))}}()&&(o||r.hasFractionPart)&&G(null,h.malformedNumber,n.slice(A,x)),{type:16,value:r.value,line:L,lineStart:k,range:[A,x]}}function W(){var e=x;switch(n.charAt(x)){case"a":return++x,"";case"n":return++x,"\n";case"r":return++x,"\r";case"t":return++x,"\t";case"v":return++x,"\v";case"b":return++x,"\b";case"f":return++x,"\f";case"\r":case"\n":return j(),"\n";case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;Q(n.charCodeAt(x))&&x-e<3;)++x;var t=n.slice(e,x),r=parseInt(t,10);return r>255&&G(null,h.decimalEscapeTooLarge,"\\"+r),o.encodeByte(r,"\\"+t);case"z":if(a.skipWhitespaceEscape)return++x,P(),"";break;case"x":if(a.hexEscapes){if(Y(n.charCodeAt(x+1))&&Y(n.charCodeAt(x+2)))return x+=3,o.encodeByte(parseInt(n.slice(e+1,x),16),"\\"+n.slice(e,x));G(null,h.hexadecimalDigitExpected,"\\"+n.slice(e,x+2))}break;case"u":if(a.unicodeEscapes)return function(){var e=x++;for("{"!==n.charAt(x++)&&G(null,h.braceExpected,"{","\\"+n.slice(e,x)),Y(n.charCodeAt(x))||G(null,h.hexadecimalDigitExpected,"\\"+n.slice(e,x));48===n.charCodeAt(x);)++x;for(var t=x;Y(n.charCodeAt(x));)++x-t>6&&G(null,h.tooLargeCodepoint,"\\"+n.slice(e,x));var r=n.charAt(x++);"}"!==r&&('"'===r||"'"===r?G(null,h.braceExpected,"}","\\"+n.slice(e,x--)):G(null,h.hexadecimalDigitExpected,"\\"+n.slice(e,x)));var a=parseInt(n.slice(t,x-1)||"0",16),i="\\"+n.slice(e,x);return a>1114111&&G(null,h.tooLargeCodepoint,i),o.encodeUTF8(a,i)}();break;case"\\":case'"':case"'":return n.charAt(x++)}return a.strictEscapes&&G(null,h.invalidEscape,"\\"+n.slice(e,x+1)),n.charAt(x++)}function J(){A=x,x+=2;var e=n.charAt(x),a="",o=!1,i=x,s=k,c=L;if("["===e&&(!1===(a=R(!0))?a=e:o=!0),!o){for(;x<r&&!H(n.charCodeAt(x));)++x;t.comments&&(a=n.slice(i,x))}if(t.comments){var l=m.comment(a,n.slice(A,x));t.locations&&(l.loc={start:{line:c,column:A-s},end:{line:L,column:x-k}}),t.ranges&&(l.range=[A,x]),t.onCreateNode&&t.onCreateNode(l),w.push(l)}}function R(e){var t,a=0,o="",i=!1,s=L;for(++x;"="===n.charAt(x+a);)++a;if("["!==n.charAt(x+a))return!1;for(x+=a+1,H(n.charCodeAt(x))&&j(),t=x;x<r;){for(;H(n.charCodeAt(x));)j();if("]"===n.charAt(x++)){i=!0;for(var c=0;c<a;++c)"="!==n.charAt(x+c)&&(i=!1);"]"!==n.charAt(x+a)&&(i=!1)}if(i)return o+=n.slice(t,x-1),x+=a+1,o}G(null,e?h.unfinishedLongComment:h.unfinishedLongString,s,"<eof>")}function _(){C=S,S=E,E=U()}function q(e){return e===S.value&&(_(),!0)}function z(e){e===S.value?_():G(S,h.expected,e,V(S))}function X(e){return 9===e||32===e||11===e||12===e}function H(e){return 10===e||13===e}function Q(e){return e>=48&&e<=57}function Y(e){return e>=48&&e<=57||e>=97&&e<=102||e>=65&&e<=70}function Z(e){return e>=65&&e<=90||e>=97&&e<=122||95===e||e>=48&&e<=57||!!(a.extendedIdentifiers&&e>=128)}function $(e){if(1===e.type)return!0;if(4!==e.type)return!1;switch(e.value){case"else":case"elseif":case"end":case"until":return!0;default:return!1}}function ee(){var e=O[D++].slice();O.push(e),t.onCreateScope&&t.onCreateScope()}function ne(){O.pop(),--D,t.onDestroyScope&&t.onDestroyScope()}function te(e){t.onLocalDeclaration&&t.onLocalDeclaration(e),-1===y(O[D],e)&&O[D].push(e)}function re(e){te(e.name),ae(e,!0)}function ae(e,n){n||-1!==function(e,n,t){for(var r=0,a=e.length;r<a;++r)if(e[r][n]===t)return r;return-1}(N,"name",e.name)||N.push(e),e.isLocal=n}function oe(e){return-1!==y(O[D],e)}Object.assign&&(T=Object.assign),e.SyntaxError=SyntaxError,e.lex=U;var ie,se=[];function ce(){return new le(S)}function le(e){t.locations&&(this.loc={start:{line:e.line,column:e.range[0]-e.lineStart},end:{line:0,column:0}}),t.ranges&&(this.range=[e.range[0],0])}function ue(){ie&&se.push(ce())}function pe(e){ie&&se.push(e)}function fe(){this.scopes=[],this.pendingGotos=[]}function de(){this.level=0,this.loopLevels=[]}function he(){return a.labels?new fe:new de}function me(e){for(var n,t=[];!$(S);){if("return"===S.value||!a.relaxedBreak&&"break"===S.value){t.push(ve(e));break}n=ve(e),q(";"),n&&t.push(n)}return t}function ve(e){if(ue(),u===S.type&&q("::"))return function(e){var n=S,r=ye();return t.scope&&(te("::"+n.value+"::"),ae(r,!0)),z("::"),e.addLabel(n.value,n),v(m.labelStatement(r))}(e);if(!a.emptyStatement||!q(";")){if(e.raiseDeferredErrors(),4===S.type)switch(S.value){case"local":return _(),function(e){var n,r=C;if(8===S.type){var a=[],o=[];do{n=ye(),a.push(n),e.addLocal(n.name,r)}while(q(","));if(q("="))do{var i=Ce(e);o.push(i)}while(q(","));if(t.scope)for(var s=0,c=a.length;s<c;++s)re(a[s]);return v(m.localStatement(a,o))}if(q("function"))return n=ye(),e.addLocal(n.name,r),t.scope&&(re(n),ee()),be(n,!0);B("<name>",S)}(e);case"if":return _(),function(e){var n,r,a,o=[];for(ie&&(a=se[se.length-1],se.push(a)),n=Ce(e),z("then"),t.scope&&ee(),e.pushScope(),r=me(e),e.popScope(),t.scope&&ne(),o.push(v(m.ifClause(n,r))),ie&&(a=ce());q("elseif");)pe(a),n=Ce(e),z("then"),t.scope&&ee(),e.pushScope(),r=me(e),e.popScope(),t.scope&&ne(),o.push(v(m.elseifClause(n,r))),ie&&(a=ce());return q("else")&&(ie&&(a=new le(C),se.push(a)),t.scope&&ee(),e.pushScope(),r=me(e),e.popScope(),t.scope&&ne(),o.push(v(m.elseClause(r)))),z("end"),v(m.ifStatement(o))}(e);case"return":return _(),function(e){var n=[];if("end"!==S.value){var t=Se(e);for(null!=t&&n.push(t);q(",");)t=Ce(e),n.push(t);q(";")}return v(m.returnStatement(n))}(e);case"function":return _(),be(function(){var e,n,r;for(ie&&(r=ce()),e=ye(),t.scope&&(ae(e,oe(e.name)),ee());q(".");)pe(r),n=ye(),e=v(m.memberExpression(e,".",n));return q(":")&&(pe(r),n=ye(),e=v(m.memberExpression(e,":",n)),t.scope&&te("self")),e}());case"while":return _(),function(e){var n=Ce(e);z("do"),t.scope&&ee(),e.pushScope(!0);var r=me(e);return e.popScope(),t.scope&&ne(),z("end"),v(m.whileStatement(n,r))}(e);case"for":return _(),function(e){var n,r=ye();if(t.scope&&(ee(),re(r)),q("=")){var a=Ce(e);z(",");var o=Ce(e),i=q(",")?Ce(e):null;return z("do"),e.pushScope(!0),n=me(e),e.popScope(),z("end"),t.scope&&ne(),v(m.forNumericStatement(r,a,o,i,n))}for(var s=[r];q(",");)r=ye(),t.scope&&re(r),s.push(r);z("in");var c=[];do{var l=Ce(e);c.push(l)}while(q(","));return z("do"),e.pushScope(!0),n=me(e),e.popScope(),z("end"),t.scope&&ne(),v(m.forGenericStatement(s,c,n))}(e);case"repeat":return _(),function(e){t.scope&&ee(),e.pushScope(!0);var n=me(e);z("until"),e.raiseDeferredErrors();var r=Ce(e);return e.popScope(),t.scope&&ne(),v(m.repeatStatement(r,n))}(e);case"break":return _(),e.isInLoop()||G(S,h.noLoopToBreak,S.value),v(m.breakStatement());case"do":return _(),function(e){t.scope&&ee(),e.pushScope();var n=me(e);return e.popScope(),t.scope&&ne(),z("end"),v(m.doStatement(n))}(e);case"goto":return _(),ge(e)}return a.contextualGoto&&8===S.type&&"goto"===S.value&&8===E.type&&"goto"!==E.value?(_(),ge(e)):(ie&&se.pop(),function(e){var n,r,a,o,i,s=[];for(ie&&(r=ce());;){if(ie&&(n=ce()),8===S.type)i=S.value,o=ye(),t.scope&&ae(o,oe(i)),a=!0;else{if("("!==S.value)return F(S);_(),o=Ce(e),z(")"),a=!1}e:for(;;){switch(2===S.type?'"':S.value){case".":case"[":a=!0;break;case":":case"(":case"{":case'"':a=null;break;default:break e}o=Ae(o,n,e)}if(s.push(o),","!==S.value)break;if(!a)return F(S);_()}if(1===s.length&&null===a)return pe(n),v(m.callStatement(s[0]));if(!a)return F(S);z("=");var c=[];do{c.push(Ce(e))}while(q(","));return pe(r),v(m.assignmentStatement(s,c))}(e))}ie&&se.pop()}function ge(e){var n=S.value,t=C,r=ye();return e.addGoto(n,t),v(m.gotoStatement(r))}function ye(){ue();var e=S.value;return 8!==S.type&&B("<name>",S),_(),v(m.identifier(e))}function be(e,n){var r=he();r.pushScope();var a=[];if(z("("),!q(")"))for(;;){if(8===S.type){var o=ye();if(t.scope&&re(o),a.push(o),q(","))continue}else d===S.type?(r.allowVararg=!0,a.push(ke(r))):B("<name> or '...'",S);z(")");break}var i=me(r);return r.popScope(),z("end"),t.scope&&ne(),n=n||!1,v(m.functionStatement(e,a,n,i))}function xe(e){for(var n,t,r=[];;){if(ue(),u===S.type&&q("["))n=Ce(e),z("]"),z("="),t=Ce(e),r.push(v(m.tableKey(n,t)));else if(8===S.type)"="===E.value?(n=ye(),_(),t=Ce(e),r.push(v(m.tableKeyString(n,t)))):(t=Ce(e),r.push(v(m.tableValue(t))));else{if(null==(t=Se(e))){se.pop();break}r.push(v(m.tableValue(t)))}if(!(",;".indexOf(S.value)>=0))break;_()}return z("}"),v(m.tableConstructorExpression(r))}function Se(e){return we(0,e)}function Ce(e){var n=Se(e);if(null!=n)return n;B("<expression>",S)}function Ee(e){var n=e.charCodeAt(0),t=e.length;if(1===t)switch(n){case 94:return 12;case 42:case 47:case 37:return 10;case 43:case 45:return 9;case 38:return 6;case 126:return 5;case 124:return 4;case 60:case 62:return 3}else if(2===t)switch(n){case 47:return 10;case 46:return 8;case 60:case 62:return"<<"===e||">>"===e?7:3;case 61:case 126:return 3;case 111:return 1}else if(97===n&&"and"===e)return 2;return 0}function we(e,n){var r,a,o,i,s=S.value;if(ie&&(a=ce()),u===(o=S).type?"#-~".indexOf(o.value)>=0:4===o.type&&"not"===o.value){ue(),_();var c=we(10,n);null==c&&B("<expression>",S),r=v(m.unaryExpression(s,c))}if(null==r&&null==(r=ke(n))&&(r=function(e){var n,r,a;if(ie&&(a=ce()),8===S.type)r=S.value,n=ye(),t.scope&&ae(n,oe(r));else{if(!q("("))return null;n=Ce(e),z(")")}for(;;){var o=Ae(n,a,e);if(null===o)break;n=o}return n}(n)),null==r)return null;for(;s=S.value,!(0===(i=u===S.type||4===S.type?Ee(s):0)||i<=e);){"^"!==s&&".."!==s||--i,_();var l=we(i,n);null==l&&B("<expression>",S),ie&&se.push(a),r=v(m.binaryExpression(s,r,l))}return r}function Ae(e,n,t){var r,a;if(u===S.type)switch(S.value){case"[":return pe(n),_(),r=Ce(t),z("]"),v(m.indexExpression(e,r));case".":return pe(n),_(),a=ye(),v(m.memberExpression(e,".",a));case":":return pe(n),_(),a=ye(),e=v(m.memberExpression(e,":",a)),pe(n),Le(e,t);case"(":case"{":return pe(n),Le(e,t)}else if(2===S.type)return pe(n),Le(e,t);return null}function Le(e,n){if(u===S.type)switch(S.value){case"(":a.emptyStatement||S.line!==C.line&&G(null,h.ambiguousSyntax,S.value),_();var t=[],r=Se(n);for(null!=r&&t.push(r);q(",");)r=Ce(n),t.push(r);return z(")"),v(m.callExpression(e,t));case"{":ue(),_();var o=xe(n);return v(m.tableCallExpression(e,o))}else if(2===S.type)return v(m.stringCallExpression(e,ke(n)));B("function arguments",S)}function ke(e){var r,a=S.value,o=S.type;if(ie&&(r=ce()),o!==d||e.allowVararg||G(S,h.cannotUseVararg,S.value),466&o){pe(r);var i=n.slice(S.range[0],S.range[1]);return _(),v(m.literal(o,a,i))}return 4===o&&"function"===a?(pe(r),_(),t.scope&&ee(),be(null)):q("{")?(pe(r),xe(e)):void 0}le.prototype.complete=function(){t.locations&&(this.loc.end.line=C.lastLine||C.line,this.loc.end.column=C.range[1]-(C.lastLineStart||C.lineStart)),t.ranges&&(this.range[1]=C.range[1])},le.prototype.bless=function(e){if(this.loc){var n=this.loc;e.loc={start:{line:n.start.line,column:n.start.column},end:{line:n.end.line,column:n.end.column}}}this.range&&(e.range=[this.range[0],this.range[1]])},fe.prototype.isInLoop=function(){for(var e=this.scopes.length;e-- >0;)if(this.scopes[e].isLoop)return!0;return!1},fe.prototype.pushScope=function(e){var n={labels:{},locals:[],deferredGotos:[],isLoop:!!e};this.scopes.push(n)},fe.prototype.popScope=function(){for(var e=0;e<this.pendingGotos.length;++e){var n=this.pendingGotos[e];n.maxDepth>=this.scopes.length&&--n.maxDepth<=0&&G(n.token,h.labelNotVisible,n.target)}this.scopes.pop()},fe.prototype.addGoto=function(e,n){for(var t=[],r=0;r<this.scopes.length;++r){var a=this.scopes[r];if(t.push(a.locals.length),Object.prototype.hasOwnProperty.call(a.labels,e))return}this.pendingGotos.push({maxDepth:this.scopes.length,target:e,token:n,localCounts:t})},fe.prototype.addLabel=function(e,n){var t=this.currentScope();if(Object.prototype.hasOwnProperty.call(t.labels,e))G(n,h.labelAlreadyDefined,e,t.labels[e].line);else{for(var r=[],a=0;a<this.pendingGotos.length;++a){var o=this.pendingGotos[a];o.maxDepth>=this.scopes.length&&o.target===e?o.localCounts[this.scopes.length-1]<t.locals.length&&t.deferredGotos.push(o):r.push(o)}this.pendingGotos=r}t.labels[e]={localCount:t.locals.length,line:n.line}},fe.prototype.addLocal=function(e,n){this.currentScope().locals.push({name:e,token:n})},fe.prototype.currentScope=function(){return this.scopes[this.scopes.length-1]},fe.prototype.raiseDeferredErrors=function(){for(var e=this.currentScope(),n=e.deferredGotos,t=0;t<n.length;++t){var r=n[t];G(r.token,h.gotoJumpInLocalScope,r.target,e.locals[r.localCounts[this.scopes.length-1]].name)}},de.prototype.isInLoop=function(){return!!this.loopLevels.length},de.prototype.pushScope=function(e){++this.level,e&&this.loopLevels.push(this.level)},de.prototype.popScope=function(){var e=this.loopLevels,n=e.length;n&&e[n-1]===this.level&&e.pop(),--this.level},de.prototype.addGoto=de.prototype.addLabel=function(){throw new Error("This should never happen")},de.prototype.addLocal=de.prototype.raiseDeferredErrors=function(){},e.parse=function(s,c){if(void 0===c&&"object"==typeof s&&(c=s,s=void 0),c||(c={}),n=s||"",t=T({},i,c),x=0,L=1,k=0,r=n.length,O=[[]],D=0,N=[],se=[],!Object.prototype.hasOwnProperty.call(Oe,t.luaVersion))throw new Error(b("Lua version '%1' not supported",t.luaVersion));if(a=T({},Oe[t.luaVersion]),void 0!==t.extendedIdentifiers&&(a.extendedIdentifiers=!!t.extendedIdentifiers),!Object.prototype.hasOwnProperty.call(l,t.encodingMode))throw new Error(b("Encoding mode '%1' not supported",t.encodingMode));return o=l[t.encodingMode],t.comments&&(w=[]),t.wait?e:Ne()};var Oe={5.1:{},5.2:{labels:!0,emptyStatement:!0,hexEscapes:!0,skipWhitespaceEscape:!0,strictEscapes:!0,relaxedBreak:!0},5.3:{labels:!0,emptyStatement:!0,hexEscapes:!0,skipWhitespaceEscape:!0,strictEscapes:!0,unicodeEscapes:!0,bitwiseOperators:!0,integerDivision:!0,relaxedBreak:!0},LuaJIT:{labels:!0,contextualGoto:!0,hexEscapes:!0,skipWhitespaceEscape:!0,strictEscapes:!0,unicodeEscapes:!0,imaginaryNumbers:!0,integerSuffixes:!0}};function De(t){return n+=String(t),r=n.length,e}function Ne(e){void 0!==e&&De(e),n&&"#!"===n.substr(0,2)&&(n=n.replace(/^.*/,(function(e){return e.replace(/./g," ")}))),r=n.length,ie=t.locations||t.ranges,E=U();var a=function(){_(),ue(),t.scope&&ee();var e=he();e.allowVararg=!0,e.pushScope();var n=me(e);return e.popScope(),t.scope&&ne(),1!==S.type&&F(S),ie&&!n.length&&(C=S),v(m.chunk(n))}();if(t.comments&&(a.comments=w),t.scope&&(a.globals=N),se.length>0)throw new Error("Location tracking failed. This is most likely a bug in luaparse");return a}e.write=De,e.end=Ne},c=(o=r.exports)&&!o.nodeType&&o,p=(l=a&&!a.nodeType&&a)&&l.exports===c&&c,!(u=c&&l&&"object"==typeof e&&e)||u.global!==u&&u.window!==u&&u.self!==u||(i=u),s(c&&l?p?l.exports:c:i.luaparse={})),r.exports))};export{f as A};
